{"version":3,"sources":["assets\\framework\\plugin_boosts\\ui\\View.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import UIComponent from \"./UIComponent\";\nimport ViewManager from \"./ViewManager\";\nimport { event } from \"../utils/EventManager\";\nimport UIFunctions from \"./UIFunctions\";\nimport { Toast } from \"./ToastManager\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class View extends UIComponent {\n    // isTouchEnabled: boolean = true;\n    emit(event,msg)\n    {\n        event.emit(msg)\n      // this.node.emit(msg);  \n    }\n\n    name:string;\n    @property\n    isDialog:boolean = false;\n\n    @property\n    hasWidget:boolean = false;\n\n    target:any;\n\n    @property\n    opacity:number = 160;\n\n    @property\n    childrenAnimation:boolean = false;\n\n\n    touchBlocker:cc.Node = null;\n    touchBlockerComp:cc.BlockInputEvents = null;\n\n    // @property\n    // showAnimationName:string = \"\";\n    // @property\n    // hideAnimationName:string = \"\";\n\n    // @property([cc.Component.EventHandler])\n    // onShownEvents:cc.Component.EventHandler[] = [];\n\n    // @property([cc.Component.EventHandler])\n    // onHiddenEvents:cc.Component.EventHandler[] = [];\n\n    animations:cc.Animation[] = [];\n\n    call(event,exp:string)\n    {\n        // eval(exp);\n        //g.execScript(exp);\n    }\n\n    setDelegate(target)\n    {\n        this.target = target;\n    }\n\n    onLoad()\n    {\n\n        this.touchBlocker = new cc.Node();\n        this.touchBlocker.name = \"TouchBlocker\"\n        this.touchBlocker.width = 2000;\n        this.touchBlocker.height = 2000;\n        this.touchBlockerComp = this.touchBlocker.addComponent(cc.BlockInputEvents)\n        this.node.addChild(this.touchBlocker,1000)\n        \n        if(this.childrenAnimation)\n        {\n            this.animations = UIFunctions.getChildrenAnimations(this.node)\n        }else{\n            var anim = this.node.getComponent(cc.Animation)\n            if(anim)\n                this.animations.push(anim)\n        }\n        let components = this.getComponents(cc.Component);\n        for(var i = 0; i < components.length;i++)\n        {\n            let comp:any = components[i]\n            if(comp != this)\n            {\n                if(comp.onShown||comp.onHidden)\n                {\n                    this.target = comp;\n                    break;\n                }\n            }\n        }\n\n    }\n\n    start()\n    {\n        this.touchEnabled = true;\n    }\n\n    init(viewname)\n    {\n        this.name = viewname;\n    }\n\n    hideAnimationCallback()\n    {\n        this.node.active = this.visible;\n        ViewManager.instance.checkViewStacks();\n    }\n\n    _isHiding:boolean = false;\n\n    /**\n     * //如果 实现了view的animation那么需要 animation 去做隐藏\n     * 否则会不会有animtion ，系统 将直接 设置 active 为false\n     */\n    doHideAnimation()\n    {\n        // if (!this.isDialog)\n        // {\n        //todo is in hide animtion return ;\n        // if(this.isInHideAnimation())return;\n        this.node.active = true;\n        this._isHiding = true;\n        if(!UIFunctions.doHideAnimations(this.animations,this.hideAnimationCallback,this))\n        {\n            this.node.active = false;\n            this._isHiding = false;\n        }\n        console.log(\"[View] hide:\",this.name);\n        this._visibleDirty = false;\n    }\n\n    isInHideAnimation(): any {\n        return this._isHiding\n    }\n    \n    onHidden()\n    {\n        this._visibleDirty = false;\n        if (this.target && this.target.onHidden)\n            this.target.onHidden();\n        // cc.Component.EventHandler.emitEvents(this.onHiddenEvents,[params]);\n    }\n\n    hide(index:number = 0){\n        // super.hide()\n        //ViewManager remove dd\n        if(index==1){\n            httpUtils.httpPost(consts.HTTP_RECORD_SERVER,{title:'返回界面',content:'点击关闭'},function(){});\n        }else if(index == 2){\n            httpUtils.httpPost(consts.HTTP_RECORD_SERVER,{title:'关卡选择界面',content:'点击关闭'},function(){});\n        }\n        this.touchEnabled = false;\n        ViewManager.instance.hide(this.node);\n    }\n\n    _visibleDirty:boolean;\n    \n    get visible(){return this._visibleDirty;}\n\n\n    showAnimationNextFrame(callback)\n    {\n        this.scheduleOnce(_=>{\n            UIFunctions.doShowAnimations(this.animations,callback)\n        },0)\n    }\n\n    get touchEnabled()\n    {\n        return !this.touchBlocker.active\n    }\n\n    set touchEnabled(b)\n    {\n        this.touchBlocker.active  = !b\n    }\n\n    // setTouchEnabled(bEnabled){\n    //     this.touchBlockerComp.enabled = bEnabled;\n    //     // UIFunctions.setTouchEnabled(this.node,bEnabled);\n    // }\n\n    show(...params)\n    {\n        super.show();\n        console.log(\"[View] show:\",this.name , params);\n        UIFunctions.stopAnimations(this.animations);\n       \n        // call next frames \n        // this.showAnimationDelay()\n        //确保在widget 更新结束后开始动画 ，\n        return new Promise<void>((resolve,reject)=>{\n            let self = this;\n            \n            let showFinishCallback = function() \n            {\n                if(!self.touchEnabled)\n                    self.touchEnabled = true;\n                resolve();\n            }\n            if(!this.hasWidget)\n            {\n                UIFunctions.doShowAnimations(this.animations,showFinishCallback)\n            }else{\n                this.showAnimationNextFrame(showFinishCallback)\n            }\n            this._visibleDirty = true;\n            if (this.target && this.target.onShown)\n            {\n                this.target.onShown(...params);\n            }\n            // cc.Component.EventHandler.emitEvents(this.onShownEvents,[params]);\n        })\n    }\n}\n"]}