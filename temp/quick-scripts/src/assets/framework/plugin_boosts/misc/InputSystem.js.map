{"version":3,"sources":["assets\\framework\\plugin_boosts\\misc\\InputSystem.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import JoyStick from \"./JoyStick\";\n\nconst {ccclass, property} = cc._decorator;\n\nexport var Input:InputSystem = null;\n\n@ccclass\nexport class InputSystem extends cc.Component\n{\n\n    // @property(cc.Component.EventHandler)\n    // onKeyDown:cc.Component.EventHandler;\n\n    _target:any = null;\n\n\n\n    keys:{[index:string]:boolean} = {}\n\n    __touch:cc.Vec2;\n\n    __startLocation :cc.Vec2;\n\n    __touchVec:cc.Vec2 = cc.Vec2.ZERO;\n\n    radius_axis:number = 256;\n\n    @property(JoyStick)\n    joyStick :JoyStick= null;\n\n    /**\n     * if target is a Component ,this function must be called in onLoad\n     * @param target \n     */\n    setDelegate(target)\n    {\n        this._target = target;\n    }\n\n\n\n    onLoad()\n    {\n        Input = this;\n\n        let components = this.getComponents(cc.Component);\n        for(var i = 0; i < components.length;i++)\n        {\n            let comp:any = components[i]\n            if(comp != this && (comp.onTouchBegan || comp.onTouchEnded||comp.onTouchMoved))\n            {\n                this._target = comp;\n                break;\n            }\n        }\n        console.log(\"InputSystem Component -> target:\",this._target)\n    }\n\n    //Horizontal\n    //Vertical\n    start()\n    {\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.triggerKeyDown,this);\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.triggerKeyUp,this);\n        // if(this._target)\n        // {\n        this.node.on(cc.Node.EventType.TOUCH_START,this.triggerTouchBegan, this);\n        this.node.on(cc.Node.EventType.TOUCH_MOVE,this.triggerTouchMoved, this);\n        this.node.on(cc.Node.EventType.TOUCH_END,this.triggerTouchEnded, this);\n        this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.triggerTouchCanceled, this);\n        \n        // }\n    }\n\n\n    get touch()\n    {\n        return this.__touch;\n    }\n\n    // only valid when joystick is enabled \n    get axis()\n    {\n        if(this.joyStick)\n            return this.joyStick.axis;\n        else\n            return this.__touchVec;\n    }\n\n    getKey(k)\n    {\n        return this.keys[k] \n    }\n\n    private triggerKeyUp(e) {\n        if(this._target.onKeyUp)\n            this._target.onKeyUp(event)\n        this.keys[event[\"key\"]] = false;\n    }\n\n    private triggerKeyDown(e): any {\n        if(this._target.onKeyDown)\n            this._target.onKeyDown(event)\n        this.keys[event[\"key\"]] = true;\n    }\n    \n    private triggerTouchEnded(e): any {\n        if(this.__curTouchId !=-1 && e.getID() != this.__curTouchId)\n        {\n            return;\n        }\n        this.__curTouchId = -1\n        if(this._target.onTouchEnded)\n            this._target.onTouchEnded(e)\n        \n        this.__touch = null \n        this.__touchVec = cc.Vec2.ZERO;\n        if(e.currentTouch)\n            if(this.joyStick)\n                this.joyStick.touchEnd(e.currentTouch.getLocation())\n        \n        this.moveOffset = cc.Vec2.ZERO;\n    }\n\n    __lastTouch:cc.Vec2 = cc.Vec2.ZERO;\n    moveOffset:cc.Vec2 = cc.Vec2.ZERO;\n\n    private triggerTouchMoved(e): any {\n        if(this.__curTouchId !=-1 && e.getID() != this.__curTouchId)\n        {\n            return;\n        }\n        if(this._target.onTouchMoved)\n            this._target.onTouchMoved(e)\n\n        this.__touch = e.currentTouch.getLocation();\n        this.moveOffset = this.__touch.sub(this.__lastTouch)\n        if(this.__touch && this.__startLocation)\n        {\n            this.__touchVec = this.__touch.sub(this.__startLocation);\n            if(this.joyStick)\n                this.joyStick.touchMove(this.__touch)\n        }\n        this.__lastTouch = this.__touch;\n    }\n\n    __curTouchId:number = -1;\n\n    private triggerTouchBegan(e): any {\n        if(this.__curTouchId !=-1 && e.getID() != this.__curTouchId)\n        {\n            return;\n        }\n        \n        if(this._target.onTouchBegan)\n            this._target.onTouchBegan(e)\n        this.__curTouchId = e.getID();\n        this.__startLocation = e.currentTouch.getLocation()\n        this.__touch = e.currentTouch.getLocation();\n        this.__lastTouch = this.__touch;\n        if(this.joyStick)\n            this.joyStick.touchStart(this.__startLocation)\n    }\n    private triggerTouchCanceled(e): any {\n        this.triggerTouchEnded(e);\n    }\n\n    onEnable()\n    {\n        this.schedule(this.checkTouch,0.02);\n    }\n\n    onDisable()\n    {\n        this.unschedule(this.checkTouch);\n    }\n\n    checkTouch()\n    {\n        if(this.__touch)\n        {\n            this.moveOffset = this.__touch.sub(this.__lastTouch);\n        }\n    }\n}"]}