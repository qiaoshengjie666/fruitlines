{"version":3,"sources":["assets\\gameComon\\screenRecord\\screenrecordHand.js"],"names":["recorder","videoPathGame","countDownTimeOut","cc","Class","Component","properties","screenSprite","SpriteFrame","onLoad","isClick","screenStatus","node","on","Node","EventType","TOUCH_END","screenBtnCallBack","initRefreshUI","sys","platform","BYTEDANCE_GAME","active","onDestroy","clearTimeout","getChildByName","getComponent","Sprite","spriteFrame","event","appGame","emitter","emit","consts","LOCAL_EVENT_POPUP_LOADTIP","content","setTimeout","bind","tt","shareAppMessage","channel","title","HTTP_RECORD_PACKAGENAME","imageUrl","query","extra","videoPath","videoTopics","success","console","log","fail","e","getGameRecorderManager","start","duration","onStart","res","onStop","stop"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\nvar recorder;\r\nvar videoPathGame;\r\nvar countDownTimeOut;\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        screenSprite:[cc.SpriteFrame]\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        //true可点击   false不可点击\r\n        this.isClick = true;\r\n        //1 可以点击录屏   2 正在录屏中   3分享\r\n        this.screenStatus = 1;\r\n        this.node.on(cc.Node.EventType.TOUCH_END,this.screenBtnCallBack,this);\r\n        this.initRefreshUI();\r\n        if(cc.sys.platform == cc.sys.BYTEDANCE_GAME){\r\n            this.node.active = true;\r\n        }else{\r\n            this.node.active = false;\r\n        }\r\n    },\r\n\r\n    onDestroy(){\r\n        clearTimeout(countDownTimeOut);\r\n    },\r\n\r\n    initRefreshUI(){\r\n        if(this.screenStatus ==3){\r\n            this.node.getChildByName('Background').getComponent(cc.Sprite).spriteFrame = this.screenSprite[2];\r\n        }else if(this.screenStatus ==2){\r\n            this.node.getChildByName('Background').getComponent(cc.Sprite).spriteFrame = this.screenSprite[1];\r\n        }else{\r\n            this.node.getChildByName('Background').getComponent(cc.Sprite).spriteFrame = this.screenSprite[0];\r\n        }\r\n    },\r\n\r\n    screenBtnCallBack(event){\r\n        if(!this.isClick){ //录屏时间太短   不能点击\r\n            appGame.emitter.emit(consts.LOCAL_EVENT_POPUP_LOADTIP, {\r\n                content:\"录屏时间太短！！！\"\r\n            });\r\n            return;\r\n        }\r\n        if(this.screenStatus == 1){//点击录屏\r\n            this.screenStatus = 2;\r\n        }else if(this.screenStatus == 2){//点击录屏中\r\n            this.screenStatus = 3;\r\n        }else if(this.screenStatus == 3){//点击分享\r\n            this.screenStatus = 1;\r\n        }\r\n        if(this.screenStatus==2){\r\n            this.isClick = false;\r\n        }\r\n        countDownTimeOut = setTimeout(function() {\r\n            this.isClick = true;\r\n            clearTimeout(countDownTimeOut);\r\n        }.bind(this), 5000);\r\n        this.initRefreshUI()\r\n        if(cc.sys.platform == cc.sys.BYTEDANCE_GAME){ //头条平台\r\n            if(this.screenStatus==1){\r\n                if(videoPathGame==null){\r\n                    appGame.emitter.emit(consts.LOCAL_EVENT_POPUP_LOADTIP, {\r\n                        content: \"录屏时间太短！！！\"\r\n                    });\r\n                    return;\r\n                }\r\n                if(cc.sys.platform == cc.sys.BYTEDANCE_GAME){ //头条平台\r\n                    tt.shareAppMessage({\r\n                        channel: 'video',\r\n                        title: consts.HTTP_RECORD_PACKAGENAME,\r\n                        imageUrl: '',\r\n                        query: '',\r\n                        extra: {\r\n                            videoPath: videoPathGame, // 可用录屏得到的视频地址\r\n                            videoTopics: ['大家一起来玩'+consts.HTTP_RECORD_PACKAGENAME+'！！！']\r\n                        },\r\n                        success() {\r\n                            console.log('分享视频成功');\r\n                        },\r\n                        fail(e) {\r\n                            console.log('分享视频失败');\r\n                            appGame.emitter.emit(consts.LOCAL_EVENT_POPUP_LOADTIP, {\r\n                                content: \"分享视频失败\"\r\n                            });\r\n                        }\r\n                    });\r\n                }\r\n            }else if(this.screenStatus==2){\r\n                if(!recorder) recorder = tt.getGameRecorderManager();\r\n                recorder.start({\r\n                    duration: 100000,\r\n                });\r\n\r\n                recorder.onStart(res =>{\r\n                    console.log('开始录屏');\r\n                });\r\n        \r\n                recorder.onStop(res =>{\r\n                    console.log(res.videoPath);\r\n                    videoPathGame = res.videoPath;\r\n                    console.log('录屏结束');\r\n                });\r\n            }else if(this.screenStatus==3){\r\n                if(!recorder) recorder = tt.getGameRecorderManager();\r\n                recorder.stop();\r\n                recorder.onStop((res) => {\r\n                    videoPathGame = res.videoPath;\r\n                    console.log('手动停止录屏==='+ res.videoPath)\r\n                });\r\n            }\r\n        }\r\n    },\r\n\r\n    start () {\r\n\r\n    },\r\n    // update (dt) {},\r\n});\r\n"]}