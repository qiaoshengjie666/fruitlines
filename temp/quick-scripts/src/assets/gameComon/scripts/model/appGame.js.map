{"version":3,"sources":["assets\\gameComon\\scripts\\model\\appGame.js"],"names":["Emitter","require","AppGame","cc","Class","properties","ctor","log","self","gameServerRoom","videoBanner","interstitialAd","banner","nativeAd","appBoxAd","blockAd","gridAd","deviceInfo","userId","nativeAdData","visibleSize","view","getVisibleSize","platform","screenAuto","appStartTime","appFinishTime","isClick","sys","BYTEDANCE_GAME","packageVersion","WECHAT_GAME","BAIDU_GAME","OPPO_GAME","XIAOMI_GAME","VIVO_GAME","ANDROID","createObj","className","ctorFun","obj","audioMgr","emitter","AppEmitter","show2Hide","statics","init","window","appGame","consts","httpUtils","async","underscore","util","platformFun","os","OS_ANDROID","androidHelper","game","on","EVENT_SHOW","gameConfigData","isbanner","playAd","isHadWord","spreadWordFun","console","EVENT_HIDE","wordRid","spreadClose","Date","getTime","timeConvertInt","httpPost","HTTP_RECORD_SERVER","title","content","desc","module","exports","app","addEventListener","event","fn","call","removeEventListener","off","prototype","EventEmitter"],"mappings":"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","sourceRoot":"/","sourcesContent":["/**\n * 模型层根节点\n */\nvar Emitter = require('emitter');\nvar AppGame = cc.Class({\n    properties: {\n    },\n\n    ctor: function () {\n        cc.log('create new AppGame start');\n        var self = this;\n        this.gameServerRoom = {};\n        this.videoBanner = {}; //激励视频\n        this.interstitialAd = {}; //插屏广告\n        this.banner = {}; //banner广告\n        this.nativeAd = {}; //原生广告\n        this.appBoxAd = {}; //盒子广告\n        this.blockAd = {}; //积木广告\n        this.gridAd = {};\n        this.deviceInfo = \"\"; //设备信息\n        this.userId = \"\";  //本地生成的玩家userId\n        this.nativeAdData = null;\n        this.visibleSize = cc.view.getVisibleSize();\n        this.platform = ''; //平台\n        this.screenAuto={};//录屏\n        this.appStartTime = 0;\n        this.appFinishTime = 0;\n        this.isClick = false;  //录屏时常判断\n\n\n        if(cc.sys.platform == cc.sys.BYTEDANCE_GAME){ //字节\n            this.packageVersion = \"1.0.0\";\n            this.platform = 'toutiao';\n        }else if(cc.sys.platform == cc.sys.WECHAT_GAME){ //微信  QQ   WX\n            this.packageVersion = \"1.0.0\";\n            this.platform = 'QQ';\n        }else if(cc.sys.platform == cc.sys.BAIDU_GAME){ //百度\n            this.packageVersion = \"1.0.0\";\n            this.platform = 'baidu';\n        }else if(cc.sys.platform == cc.sys.OPPO_GAME){ //oppo\n            this.packageVersion = \"1.0.0\";\n            this.platform = 'oppo';\n        }else if(cc.sys.platform == cc.sys.XIAOMI_GAME){ //小米\n            this.packageVersion = \"1.0.0\";\n            this.platform = 'xiaomi';\n        }else if(cc.sys.platform == cc.sys.VIVO_GAME){  //vivo\n            this.packageVersion = \"1.0.0\";\n            this.platform = 'vivo';\n        }else if(cc.sys.platform == cc.sys.ANDROID){\n            this.packageVersion = \"1.0.0\";\n            this.platform = 'android';\n        }else{\n            this.packageVersion = \"1.0.0\";\n            this.platform = 'QQ';\n        }\n\n        var createObj = function (className) {\n            var ctorFun = require(className);\n            var obj = new ctorFun(self);\n            cc.log('初始化AppGame时已创建%s', className);\n            return obj;\n        };\n        this.audioMgr = createObj('audioMgr'); //音效\n        this.emitter = new AppEmitter(this); //弹窗、跑马灯等公用事件的注册和触发工具\n        cc.log('create new AppGame end');\n        this.show2Hide();\n    },\n    statics: {\n        init: function () {\n            if (!window.appGame) {\n                cc.log('have no window.AppGame');\n                window.consts = require('consts');\n                window.httpUtils = require('httpUtils');\n                window.async = require('async');\n                window.underscore = require('underscore');\n                window.util = require('util');\n                window.platformFun = require('platformFun');\n                if(cc.sys.os == cc.sys.OS_ANDROID) {\n                    window.androidHelper = require('androidHelper');\n                }\n                window.appGame = new AppGame();\n            } else {\n                cc.log('have window.app, so do nothing');\n            }\n        }\n    },\n\n    show2Hide(){\n        /* 游戏进入前台 */\n        cc.game.on(cc.game.EVENT_SHOW, function () {\n            if(appGame.interstitialAd&&appGame.gameServerRoom.gameConfigData&&!appGame.gameServerRoom.gameConfigData.isbanner){\n                appGame.interstitialAd.playAd();\n            }\n            if(appGame.gameServerRoom && appGame.gameServerRoom.isHadWord){\n                util.spreadWordFun();\n            }\n            console.log('game enter fore on');\n        });\n        /* 游戏进入后台 */\n        cc.game.on(cc.game.EVENT_HIDE, function () {\n            console.log('game enter back on');\n            if(appGame.gameServerRoom && appGame.gameServerRoom.wordRid){\n                util.spreadClose(appGame.gameServerRoom.wordRid);\n            }\n            if(appGame.appStartTime!=0){//超过10分钟的话不用打点\n                appGame.appFinishTime = new Date().getTime() - appGame.appStartTime;\n                appGame.appFinishTime = util.timeConvertInt(appGame.appFinishTime);\n                httpUtils.httpPost(consts.HTTP_RECORD_SERVER,{title:'关闭APP',content:'APP停留时长',desc:appGame.appFinishTime},function(){\n                });\n            }\n        });\n    },\n});\n\nmodule.exports = AppGame;\n\nvar AppEmitter = function (app) {\n    var addEventListener = this.addEventListener;\n    this.on =\n        this.addEventListener = function (event, fn, obj) {\n            //cc.log('添加app本地事件，%s', event);\n            addEventListener.call(this, event, fn, obj);\n        };\n    var removeEventListener = this.removeEventListener;\n    this.off =\n        this.removeEventListener = function (event, fn) {\n            //cc.log('删除app本地事件，%s', event);\n            removeEventListener.call(this, event, fn);\n        };\n};\n\nAppEmitter.prototype = new EventEmitter();"]}