{"version":3,"sources":["assets\\gameComon\\scripts\\ad\\wxgridAd.js"],"names":["GridAd","cc","Class","properties","ctor","instance","statics","create","data","initWithData","targetBannerAdWidth","sys","platform","WECHAT_GAME","appGame","wx","getSystemInfoSync","windowWidth","windowHeight","width","height","adId","gameServerRoom","adConfig","gridId","WX","adUnitId","console","log","globalData","gridAd","createGridAd","adIntervals","adTheme","gridCount","style","top","left","opacity","httpUtils","httpPost","consts","HTTP_RECORD_SERVER","title","content","desc","refreshSize","playGridAd","isShow","show","then","hide","onResize","size","onError","listener","errCode","errMsg","module","exports"],"mappings":"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","sourceRoot":"/","sourcesContent":["var GridAd = cc.Class({\r\n    properties: {\r\n    },\r\n    ctor() {\r\n        this.instance = null;\r\n    },\r\n    statics: {\r\n        create: function (data) {\r\n            if (!this.instance) {\r\n                this.instance = new GridAd();\r\n                this.instance.initWithData(data);\r\n                return this.instance;\r\n            }\r\n        }\r\n    },\r\n    initWithData: function (data) {\r\n        this.targetBannerAdWidth = 200;\r\n        if (cc.sys.platform == cc.sys.WECHAT_GAME && appGame.platform == 'WX') {\r\n            const { windowWidth, windowHeight } = wx.getSystemInfoSync();\r\n            this.width = windowWidth;\r\n            this.height = windowHeight;\r\n            this.adId = 'adunit-144bcfc4f8f3cefe';\r\n            if(appGame.gameServerRoom.adConfig && appGame.gameServerRoom.adConfig.gridId && appGame.gameServerRoom.adConfig.gridId.WX){\r\n                this.adId = appGame.gameServerRoom.adConfig.gridId.WX.adUnitId;\r\n            }\r\n            console.log(\"grid 第一次创建\")\r\n            this.globalData = {\r\n                gridAd: wx.createGridAd({\r\n                    adUnitId: this.adId,\r\n                    adIntervals:30,\r\n                    adTheme: 'white',\r\n                    gridCount: 5,\r\n                    style: {\r\n                        // left: 0,\r\n                        // top: 0,\r\n                        // width: 330,\r\n                        width: this.targetBannerAdWidth,\r\n                        top: 0, // 根据系统约定尺寸计算出广告高度\r\n                        left: (this.width - this.targetBannerAdWidth) / 2,\r\n                        opacity: 0.8\r\n                    }\r\n                }),\r\n            }\r\n            httpUtils.httpPost(consts.HTTP_RECORD_SERVER,{title:'格子广告',content:'创建成功',desc:this.adId},function(){\r\n            });\r\n            this.refreshSize();\r\n        }\r\n    },\r\n    playGridAd: function (isShow) {\r\n        if (this.globalData && this.globalData.gridAd) {\r\n            if(isShow){\r\n                console.log(\"播放盒子广告\");\r\n                this.globalData.gridAd.show().then(() => {\r\n                    console.log(\"盒子广告展示成功\");\r\n                    httpUtils.httpPost(consts.HTTP_RECORD_SERVER,{title:'格子广告',content:'展示成功',desc:this.adId},function(){\r\n                    });\r\n                });\r\n            }else{\r\n                httpUtils.httpPost(consts.HTTP_RECORD_SERVER,{title:'格子广告',content:'隐藏',desc:this.adId},function(){\r\n                });\r\n                this.globalData.gridAd.hide();\r\n            }\r\n        }\r\n    },\r\n    refreshSize(){\r\n        // 尺寸调整时会触发回调，通过回调拿到的广告真实宽高再进行定位适配处理\r\n        // 注意：如果在回调里再次调整尺寸，要确保不要触发死循环！！！\r\n        if(this.globalData && this.globalData.gridAd){\r\n            if(cc.sys.platform == cc.sys.WECHAT_GAME){ //头条平台\r\n                this.globalData.gridAd.onResize((size) => {\r\n                    console.log(\"grid shezhi大小\"+this.height+\"   \"+this.width)\r\n                    this.globalData.gridAd.style.top = 0;\r\n                    this.globalData.gridAd.style.left = (this.width - size.width) / 2;\r\n                });\r\n            }\r\n            this.globalData.gridAd.onError((listener) => {\r\n                console.log(\"盒子广告出错\")\r\n                httpUtils.httpPost(consts.HTTP_RECORD_SERVER,{title:'格子广告',content:this.adId,desc:listener.errCode+listener.errMsg},function(){\r\n                });\r\n            });\r\n        }\r\n    },\r\n\r\n});\r\nmodule.exports = GridAd;\r\n"]}