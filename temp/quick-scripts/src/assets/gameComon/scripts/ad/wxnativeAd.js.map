{"version":3,"sources":["assets\\gameComon\\scripts\\ad\\wxnativeAd.js"],"names":["WXNativeAd","cc","Class","properties","ctor","instance","statics","create","data","initWithData","targetBannerAdWidth","sys","platform","WECHAT_GAME","appGame","wx","getSystemInfoSync","windowWidth","windowHeight","width","height","adId","gameServerRoom","adConfig","gridId","nativeId","WX","adUnitId","globalData","nativeAd","createCustomAd","adIntervals","style","left","top","httpUtils","httpPost","consts","HTTP_RECORD_SERVER","title","content","desc","refreshSize","playNativeAd","isShow","show","hide","load","then","console","log","err","onLoad","res","JSON","stringify","onError","listener","errCode","errMsg","module","exports"],"mappings":"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","sourceRoot":"/","sourcesContent":["var WXNativeAd = cc.Class({\r\n    properties: {\r\n    },\r\n    ctor() {\r\n        this.instance = null;\r\n    },\r\n    statics: {\r\n        create: function (data) {\r\n            if (!this.instance) {\r\n                this.instance = new WXNativeAd();\r\n                this.instance.initWithData(data);\r\n                return this.instance;\r\n            }\r\n        }\r\n    },\r\n    initWithData: function (data) {\r\n        this.targetBannerAdWidth = 200;\r\n        if (cc.sys.platform == cc.sys.WECHAT_GAME && appGame.platform == 'WX') { //微信平台 \r\n            const { windowWidth, windowHeight } = wx.getSystemInfoSync();\r\n            this.width = windowWidth;\r\n            this.height = windowHeight;\r\n            this.adId = 'adunit-48fb335e928d3b4d'\r\n            if(appGame.gameServerRoom.adConfig && appGame.gameServerRoom.adConfig.gridId && appGame.gameServerRoom.adConfig.nativeId.WX){\r\n                this.adId = appGame.gameServerRoom.adConfig.nativeId.WX.adUnitId;\r\n            }\r\n            this.globalData = {\r\n                nativeAd: wx.createCustomAd({\r\n                    adUnitId: this.adId,\r\n                    adIntervals:30,\r\n                    style: {\r\n                        left:20,\r\n                        top: this.height - (this.targetBannerAdWidth / 16) * 9,\r\n                    }\r\n                }),\r\n            }\r\n            httpUtils.httpPost(consts.HTTP_RECORD_SERVER,{title:'原生广告',content:'创建成功',desc:this.adId},function(){\r\n            });\r\n        }\r\n        this.refreshSize();\r\n    },\r\n    playNativeAd: function (isShow) {\r\n        if ((cc.sys.platform == cc.sys.WECHAT_GAME && appGame.platform == 'WX')) {\r\n            if (this.globalData && this.globalData.nativeAd) {\r\n                if (isShow) {\r\n                    this.globalData.nativeAd.show();\r\n                } else {\r\n                    this.globalData.nativeAd.hide();\r\n                }\r\n            }\r\n        } else {\r\n            if (this.globalData && this.globalData.nativeAd) {\r\n                let nativeAd = this.globalData.nativeAd;\r\n                nativeAd\r\n                    .load()\r\n                    .then(() => {\r\n                        console.log(\"原生广告显示成功\");\r\n                        httpUtils.httpPost(consts.HTTP_RECORD_SERVER,{title:'原生广告',content:'展示成功',desc:this.adId},function(){\r\n                        });\r\n                    })\r\n                    .catch((err) => {\r\n                        console.log(\"原生广告出现问题\", err);\r\n                        httpUtils.httpPost(consts.HTTP_RECORD_SERVER,{title:'原生广告',content:'展示失败',desc:this.adId},function(){\r\n                        });\r\n                    });\r\n                nativeAd.onLoad(res => {\r\n                    console.log(`加载原生广告成功`, `：${JSON.stringify(res)}`)\r\n                    //res.adList && res.adList.length > 0 && (appGame.nativeAdData = res.adList[0])\r\n                })\r\n            }\r\n        }\r\n    },\r\n    refreshSize(){\r\n        // 尺寸调整时会触发回调，通过回调拿到的广告真实宽高再进行定位适配处理\r\n        // 注意：如果在回调里再次调整尺寸，要确保不要触发死循环！！！\r\n        if(this.globalData && this.globalData.nativeAd){\r\n            this.globalData.nativeAd.onError((listener) => {\r\n                console.log(\"原生广告出错\")\r\n                httpUtils.httpPost(consts.HTTP_RECORD_SERVER,{title:'原生广告',content:this.adId,desc:listener.errCode+listener.errMsg},function(){\r\n                });\r\n            });\r\n        }\r\n    },\r\n});\r\nmodule.exports = WXNativeAd;\r\n"]}