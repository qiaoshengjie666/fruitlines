{"version":3,"sources":["assets\\gameComon\\scripts\\room.js"],"names":["Emitter","require","consts","Room","cc","Class","initWithData","data","adConfig","commonConfig","configSuccess1","isHadWord","async","waterfall","cb","url","HTTP_GET_PAAS_DATA_SERVER","GAME_ID","console","log","util","getUrlSerConfig","JSON","stringify","appGame","emitter","emit","HTTP_EVENT_MIDDLE_DESK_CONFIG","bind","wordShow","sys","platform","BAIDU_GAME","word","baidu","getPlatformConfig","WECHAT_GAME","WX","QQ","BYTEDANCE_GAME","toutiao","spreadWordFun","configSuccess2","gameServerRoom","CLIENT_GAME_START","err","plat","sign","revive","result","lucky","module","exports"],"mappings":"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","sourceRoot":"/","sourcesContent":["/*中台配置文件获取*/\r\nvar Emitter = require('emitter');\r\nconst consts = require('./model/consts');\r\nvar Room = cc.Class({\r\n    extends: Emitter,\r\n    initWithData: function (data) {\r\n        this.adConfig = {};\r\n        this.commonConfig = {};\r\n        this.configSuccess1 = false;\r\n        this.isHadWord = false;\r\n        async.waterfall([function(cb){\r\n            let url = consts.HTTP_GET_PAAS_DATA_SERVER+\"?gameId=\"+consts.GAME_ID+\"&plat=all\"\r\n           +\"&version=all\"+\"&brand=\"+''+\"&from=ad\";\r\n            //url = 'https://cs.snmi.cn/game/GetGameValue?gameId=50&plat=baidu&version=1.0.0&brand=&from=ad'\r\n            console.log(\"ad url===\"+url)\r\n            util.getUrlSerConfig(url,'comJson','comAdConfig',function(data){\r\n                this.adConfig = data;\r\n                console.log(\"ad ==\"+JSON.stringify(this.adConfig))\r\n                appGame.emitter.emit(consts.HTTP_EVENT_MIDDLE_DESK_CONFIG,{});\r\n                cb(null);\r\n            }.bind(this));\r\n        }.bind(this),function(cb){\r\n            let url = consts.HTTP_GET_PAAS_DATA_SERVER+\"?gameId=\"+consts.GAME_ID+\"&plat=all\"\r\n           +\"&version=all\"+\"&brand=\"+''+\"&from=MiddleDesk\";\r\n            //url = 'https://cs.snmi.cn/game/GetGameValue?gameId=50&plat=baidu&version=1.0.0&brand=&from=MiddleDesk'\r\n            //console.log(\"middledesk url===\"+url)\r\n            util.getUrlSerConfig(url,'comJson','comConfig',function(data){\r\n                this.commonConfig = data;\r\n               // console.log(\"MiddleDesk ==\"+JSON.stringify(this.commonConfig))\r\n                let wordShow = 0;\r\n                if(cc.sys.platform == cc.sys.BAIDU_GAME){\r\n                    wordShow = this.commonConfig.word.baidu;\r\n                    this.getPlatformConfig('baidu');\r\n                }else if(cc.sys.platform == cc.sys.WECHAT_GAME && appGame.platform == 'WX'){\r\n                    wordShow = this.commonConfig.word.WX;\r\n                    this.getPlatformConfig('WX');\r\n                }else if(cc.sys.platform == cc.sys.WECHAT_GAME && appGame.platform == 'QQ'){\r\n                    wordShow = this.commonConfig.word.QQ;\r\n                    this.getPlatformConfig('QQ');\r\n                }else if(cc.sys.platform == cc.sys.BYTEDANCE_GAME){\r\n                    wordShow = this.commonConfig.word.toutiao;\r\n                    this.getPlatformConfig('toutiao');\r\n                }else{\r\n                    this.getPlatformConfig('html5');\r\n                }\r\n                if(wordShow){\r\n                    this.isHadWord = true;\r\n                    util.spreadWordFun();\r\n                }\r\n                this.configSuccess1 = true;\r\n                if(this.configSuccess2 && this.configSuccess1){\r\n                    appGame.gameServerRoom.emit(consts.CLIENT_GAME_START,{});\r\n                }\r\n            }.bind(this));\r\n        }.bind(this)],function(err){\r\n            console.log(\"读取配置出错了!!\")\r\n        });\r\n    },\r\n    getPlatformConfig(plat){\r\n        this.commonConfig.sign = this.commonConfig.sign[plat];\r\n        this.commonConfig.revive = this.commonConfig.revive[plat];\r\n        this.commonConfig.result = this.commonConfig.result[plat];\r\n        this.commonConfig.lucky = this.commonConfig.lucky[plat];\r\n    },\r\n});\r\n\r\nmodule.exports = Room;\r\n"]}