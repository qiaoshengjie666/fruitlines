
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/gameComon/scripts/model/appGame.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'ed2f8mb9M5M3JYlDEliFk1E', 'appGame');
// gameComon/scripts/model/appGame.js

"use strict";

/**
 * 模型层根节点
 */
var Emitter = require('emitter');

var AppGame = cc.Class({
  properties: {},
  ctor: function ctor() {
    cc.log('create new AppGame start');
    var self = this;
    this.gameServerRoom = {};
    this.videoBanner = {}; //激励视频

    this.interstitialAd = {}; //插屏广告

    this.banner = {}; //banner广告

    this.nativeAd = {}; //原生广告

    this.appBoxAd = {}; //盒子广告

    this.blockAd = {}; //积木广告

    this.gridAd = {};
    this.deviceInfo = ""; //设备信息

    this.userId = ""; //本地生成的玩家userId

    this.nativeAdData = null;
    this.visibleSize = cc.view.getVisibleSize();
    this.platform = ''; //平台

    this.screenAuto = {}; //录屏

    this.appStartTime = 0;
    this.appFinishTime = 0;
    this.isClick = false; //录屏时常判断

    if (cc.sys.platform == cc.sys.BYTEDANCE_GAME) {
      //字节
      this.packageVersion = "1.0.0";
      this.platform = 'toutiao';
    } else if (cc.sys.platform == cc.sys.WECHAT_GAME) {
      //微信  QQ   WX
      this.packageVersion = "1.0.0";
      this.platform = 'QQ';
    } else if (cc.sys.platform == cc.sys.BAIDU_GAME) {
      //百度
      this.packageVersion = "1.0.0";
      this.platform = 'baidu';
    } else if (cc.sys.platform == cc.sys.OPPO_GAME) {
      //oppo
      this.packageVersion = "1.0.0";
      this.platform = 'oppo';
    } else if (cc.sys.platform == cc.sys.XIAOMI_GAME) {
      //小米
      this.packageVersion = "1.0.0";
      this.platform = 'xiaomi';
    } else if (cc.sys.platform == cc.sys.VIVO_GAME) {
      //vivo
      this.packageVersion = "1.0.0";
      this.platform = 'vivo';
    } else if (cc.sys.platform == cc.sys.ANDROID) {
      this.packageVersion = "1.0.0";
      this.platform = 'android';
    } else {
      this.packageVersion = "1.0.0";
      this.platform = 'QQ';
    }

    var createObj = function createObj(className) {
      var ctorFun = require(className);

      var obj = new ctorFun(self);
      cc.log('初始化AppGame时已创建%s', className);
      return obj;
    };

    this.audioMgr = createObj('audioMgr'); //音效

    this.emitter = new AppEmitter(this); //弹窗、跑马灯等公用事件的注册和触发工具

    cc.log('create new AppGame end');
    this.show2Hide();
  },
  statics: {
    init: function init() {
      if (!window.appGame) {
        cc.log('have no window.AppGame');
        window.consts = require('consts');
        window.httpUtils = require('httpUtils');
        window.async = require('async');
        window.underscore = require('underscore');
        window.util = require('util');
        window.platformFun = require('platformFun');

        if (cc.sys.os == cc.sys.OS_ANDROID) {
          window.androidHelper = require('androidHelper');
        }

        window.appGame = new AppGame();
      } else {
        cc.log('have window.app, so do nothing');
      }
    }
  },
  show2Hide: function show2Hide() {
    /* 游戏进入前台 */
    cc.game.on(cc.game.EVENT_SHOW, function () {
      if (appGame.interstitialAd && appGame.gameServerRoom.gameConfigData && !appGame.gameServerRoom.gameConfigData.isbanner) {
        appGame.interstitialAd.playAd();
      }

      if (appGame.gameServerRoom && appGame.gameServerRoom.isHadWord) {
        util.spreadWordFun();
      }

      console.log('game enter fore on');
    });
    /* 游戏进入后台 */

    cc.game.on(cc.game.EVENT_HIDE, function () {
      console.log('game enter back on');

      if (appGame.gameServerRoom && appGame.gameServerRoom.wordRid) {
        util.spreadClose(appGame.gameServerRoom.wordRid);
      }

      if (appGame.appStartTime != 0) {
        //超过10分钟的话不用打点
        appGame.appFinishTime = new Date().getTime() - appGame.appStartTime;
        appGame.appFinishTime = util.timeConvertInt(appGame.appFinishTime);
        httpUtils.httpPost(consts.HTTP_RECORD_SERVER, {
          title: '关闭APP',
          content: 'APP停留时长',
          desc: appGame.appFinishTime
        }, function () {});
      }
    });
  }
});
module.exports = AppGame;

var AppEmitter = function AppEmitter(app) {
  var addEventListener = this.addEventListener;

  this.on = this.addEventListener = function (event, fn, obj) {
    //cc.log('添加app本地事件，%s', event);
    addEventListener.call(this, event, fn, obj);
  };

  var removeEventListener = this.removeEventListener;

  this.off = this.removeEventListener = function (event, fn) {
    //cc.log('删除app本地事件，%s', event);
    removeEventListener.call(this, event, fn);
  };
};

AppEmitter.prototype = new EventEmitter();

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcZ2FtZUNvbW9uXFxzY3JpcHRzXFxtb2RlbFxcYXBwR2FtZS5qcyJdLCJuYW1lcyI6WyJFbWl0dGVyIiwicmVxdWlyZSIsIkFwcEdhbWUiLCJjYyIsIkNsYXNzIiwicHJvcGVydGllcyIsImN0b3IiLCJsb2ciLCJzZWxmIiwiZ2FtZVNlcnZlclJvb20iLCJ2aWRlb0Jhbm5lciIsImludGVyc3RpdGlhbEFkIiwiYmFubmVyIiwibmF0aXZlQWQiLCJhcHBCb3hBZCIsImJsb2NrQWQiLCJncmlkQWQiLCJkZXZpY2VJbmZvIiwidXNlcklkIiwibmF0aXZlQWREYXRhIiwidmlzaWJsZVNpemUiLCJ2aWV3IiwiZ2V0VmlzaWJsZVNpemUiLCJwbGF0Zm9ybSIsInNjcmVlbkF1dG8iLCJhcHBTdGFydFRpbWUiLCJhcHBGaW5pc2hUaW1lIiwiaXNDbGljayIsInN5cyIsIkJZVEVEQU5DRV9HQU1FIiwicGFja2FnZVZlcnNpb24iLCJXRUNIQVRfR0FNRSIsIkJBSURVX0dBTUUiLCJPUFBPX0dBTUUiLCJYSUFPTUlfR0FNRSIsIlZJVk9fR0FNRSIsIkFORFJPSUQiLCJjcmVhdGVPYmoiLCJjbGFzc05hbWUiLCJjdG9yRnVuIiwib2JqIiwiYXVkaW9NZ3IiLCJlbWl0dGVyIiwiQXBwRW1pdHRlciIsInNob3cySGlkZSIsInN0YXRpY3MiLCJpbml0Iiwid2luZG93IiwiYXBwR2FtZSIsImNvbnN0cyIsImh0dHBVdGlscyIsImFzeW5jIiwidW5kZXJzY29yZSIsInV0aWwiLCJwbGF0Zm9ybUZ1biIsIm9zIiwiT1NfQU5EUk9JRCIsImFuZHJvaWRIZWxwZXIiLCJnYW1lIiwib24iLCJFVkVOVF9TSE9XIiwiZ2FtZUNvbmZpZ0RhdGEiLCJpc2Jhbm5lciIsInBsYXlBZCIsImlzSGFkV29yZCIsInNwcmVhZFdvcmRGdW4iLCJjb25zb2xlIiwiRVZFTlRfSElERSIsIndvcmRSaWQiLCJzcHJlYWRDbG9zZSIsIkRhdGUiLCJnZXRUaW1lIiwidGltZUNvbnZlcnRJbnQiLCJodHRwUG9zdCIsIkhUVFBfUkVDT1JEX1NFUlZFUiIsInRpdGxlIiwiY29udGVudCIsImRlc2MiLCJtb2R1bGUiLCJleHBvcnRzIiwiYXBwIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwiZm4iLCJjYWxsIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsIm9mZiIsInByb3RvdHlwZSIsIkV2ZW50RW1pdHRlciJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQSxJQUFJQSxPQUFPLEdBQUdDLE9BQU8sQ0FBQyxTQUFELENBQXJCOztBQUNBLElBQUlDLE9BQU8sR0FBR0MsRUFBRSxDQUFDQyxLQUFILENBQVM7QUFDbkJDLEVBQUFBLFVBQVUsRUFBRSxFQURPO0FBSW5CQyxFQUFBQSxJQUFJLEVBQUUsZ0JBQVk7QUFDZEgsSUFBQUEsRUFBRSxDQUFDSSxHQUFILENBQU8sMEJBQVA7QUFDQSxRQUFJQyxJQUFJLEdBQUcsSUFBWDtBQUNBLFNBQUtDLGNBQUwsR0FBc0IsRUFBdEI7QUFDQSxTQUFLQyxXQUFMLEdBQW1CLEVBQW5CLENBSmMsQ0FJUzs7QUFDdkIsU0FBS0MsY0FBTCxHQUFzQixFQUF0QixDQUxjLENBS1k7O0FBQzFCLFNBQUtDLE1BQUwsR0FBYyxFQUFkLENBTmMsQ0FNSTs7QUFDbEIsU0FBS0MsUUFBTCxHQUFnQixFQUFoQixDQVBjLENBT007O0FBQ3BCLFNBQUtDLFFBQUwsR0FBZ0IsRUFBaEIsQ0FSYyxDQVFNOztBQUNwQixTQUFLQyxPQUFMLEdBQWUsRUFBZixDQVRjLENBU0s7O0FBQ25CLFNBQUtDLE1BQUwsR0FBYyxFQUFkO0FBQ0EsU0FBS0MsVUFBTCxHQUFrQixFQUFsQixDQVhjLENBV1E7O0FBQ3RCLFNBQUtDLE1BQUwsR0FBYyxFQUFkLENBWmMsQ0FZSzs7QUFDbkIsU0FBS0MsWUFBTCxHQUFvQixJQUFwQjtBQUNBLFNBQUtDLFdBQUwsR0FBbUJqQixFQUFFLENBQUNrQixJQUFILENBQVFDLGNBQVIsRUFBbkI7QUFDQSxTQUFLQyxRQUFM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Q3RCO0FBQTlDLFNBQTdDLEVBQTBHLFlBQVUsQ0FDbkgsQ0FERDtBQUVIO0FBQ0osS0FYRDtBQVlIO0FBM0drQixDQUFULENBQWQ7QUE4R0FvRCxNQUFNLENBQUNDLE9BQVAsR0FBaUI3RSxPQUFqQjs7QUFFQSxJQUFJeUMsVUFBVSxHQUFHLFNBQWJBLFVBQWEsQ0FBVXFDLEdBQVYsRUFBZTtBQUM1QixNQUFJQyxnQkFBZ0IsR0FBRyxLQUFLQSxnQkFBNUI7O0FBQ0EsT0FBS3RCLEVBQUwsR0FDSSxLQUFLc0IsZ0JBQUwsR0FBd0IsVUFBVUMsS0FBVixFQUFpQkMsRUFBakIsRUFBcUIzQyxHQUFyQixFQUEwQjtBQUM5QztBQUNBeUMsSUFBQUEsZ0JBQWdCLENBQUNHLElBQWpCLENBQXNCLElBQXRCLEVBQTRCRixLQUE1QixFQUFtQ0MsRUFBbkMsRUFBdUMzQyxHQUF2QztBQUNILEdBSkw7O0FBS0EsTUFBSTZDLG1CQUFtQixHQUFHLEtBQUtBLG1CQUEvQjs7QUFDQSxPQUFLQyxHQUFMLEdBQ0ksS0FBS0QsbUJBQUwsR0FBMkIsVUFBVUgsS0FBVixFQUFpQkMsRUFBakIsRUFBcUI7QUFDNUM7QUFDQUUsSUFBQUEsbUJBQW1CLENBQUNELElBQXBCLENBQXlCLElBQXpCLEVBQStCRixLQUEvQixFQUFzQ0MsRUFBdEM7QUFDSCxHQUpMO0FBS0gsQ0FiRDs7QUFlQXhDLFVBQVUsQ0FBQzRDLFNBQVgsR0FBdUIsSUFBSUMsWUFBSixFQUF2QiIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiDmqKHlnovlsYLmoLnoioLngrlcbiAqL1xudmFyIEVtaXR0ZXIgPSByZXF1aXJlKCdlbWl0dGVyJyk7XG52YXIgQXBwR2FtZSA9IGNjLkNsYXNzKHtcbiAgICBwcm9wZXJ0aWVzOiB7XG4gICAgfSxcblxuICAgIGN0b3I6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY2MubG9nKCdjcmVhdGUgbmV3IEFwcEdhbWUgc3RhcnQnKTtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICB0aGlzLmdhbWVTZXJ2ZXJSb29tID0ge307XG4gICAgICAgIHRoaXMudmlkZW9CYW5uZXIgPSB7fTsgLy/mv4DlirHop4bpopFcbiAgICAgICAgdGhpcy5pbnRlcnN0aXRpYWxBZCA9IHt9OyAvL+aPkuWxj+W5v+WRilxuICAgICAgICB0aGlzLmJhbm5lciA9IHt9OyAvL2Jhbm5lcuW5v+WRilxuICAgICAgICB0aGlzLm5hdGl2ZUFkID0ge307IC8v5Y6f55Sf5bm/5ZGKXG4gICAgICAgIHRoaXMuYXBwQm94QWQgPSB7fTsgLy/nm5LlrZDlub/lkYpcbiAgICAgICAgdGhpcy5ibG9ja0FkID0ge307IC8v56ev5pyo5bm/5ZGKXG4gICAgICAgIHRoaXMuZ3JpZEFkID0ge307XG4gICAgICAgIHRoaXMuZGV2aWNlSW5mbyA9IFwiXCI7IC8v6K6+5aSH5L+h5oGvXG4gICAgICAgIHRoaXMudXNlcklkID0gXCJcIjsgIC8v5pys5Zyw55Sf5oiQ55qE546p5a62dXNlcklkXG4gICAgICAgIHRoaXMubmF0aXZlQWREYXRhID0gbnVsbDtcbiAgICAgICAgdGhpcy52aXNpYmxlU2l6ZSA9IGNjLnZpZXcuZ2V0VmlzaWJsZVNpemUoKTtcbiAgICAgICAgdGhpcy5wbGF0Zm9ybSA9ICcnOyAvL+W5s+WPsFxuICAgICAgICB0aGlzLnNjcmVlbkF1dG89e307Ly/lvZXlsY9cbiAgICAgICAgdGhpcy5hcHBTdGFydFRpbWUgPSAwO1xuICAgICAgICB0aGlzLmFwcEZpbmlzaFRpbWUgPSAwO1xuICAgICAgICB0aGlzLmlzQ2xpY2sgPSBmYWxzZTsgIC8v5b2V5bGP5pe25bi45Yik5patXG5cblxuICAgICAgICBpZihjYy5zeXMucGxhdGZvcm0gPT0gY2Muc3lzLkJZVEVEQU5DRV9HQU1FKXsgLy/lrZfoioJcbiAgICAgICAgICAgIHRoaXMucGFja2FnZVZlcnNpb24gPSBcIjEuMC4wXCI7XG4gICAgICAgICAgICB0aGlzLnBsYXRmb3JtID0gJ3RvdXRpYW8nO1xuICAgICAgICB9ZWxzZSBpZihjYy5zeXMucGxhdGZvcm0gPT0gY2Muc3lzLldFQ0hBVF9HQU1FKXsgLy/lvq7kv6EgIFFRICAgV1hcbiAgICAgICAgICAgIHRoaXMucGFja2FnZVZlcnNpb24gPSBcIjEuMC4wXCI7XG4gICAgICAgICAgICB0aGlzLnBsYXRmb3JtID0gJ1FRJztcbiAgICAgICAgfWVsc2UgaWYoY2Muc3lzLnBsYXRmb3JtID09IGNjLnN5cy5CQUlEVV9HQU1FKXsgLy/nmb7luqZcbiAgICAgICAgICAgIHRoaXMucGFja2FnZVZlcnNpb24gPSBcIjEuMC4wXCI7XG4gICAgICAgICAgICB0aGlzLnBsYXRmb3JtID0gJ2JhaWR1JztcbiAgICAgICAgfWVsc2UgaWYoY2Muc3lzLnBsYXRmb3JtID09IGNjLnN5cy5PUFBPX0dBTUUpeyAvL29wcG9cbiAgICAgICAgICAgIHRoaXMucGFja2FnZVZlcnNpb24gPSBcIjEuMC4wXCI7XG4gICAgICAgICAgICB0aGlzLnBsYXRmb3JtID0gJ29wcG8nO1xuICAgICAgICB9ZWxzZSBpZihjYy5zeXMucGxhdGZvcm0gPT0gY2Muc3lzLlhJQU9NSV9HQU1FKXsgLy/lsI/nsbNcbiAgICAgICAgICAgIHRoaXMucGFja2FnZVZlcnNpb24gPSBcIjEuMC4wXCI7XG4gICAgICAgICAgICB0aGlzLnBsYXRmb3JtID0gJ3hpYW9taSc7XG4gICAgICAgIH1lbHNlIGlmKGNjLnN5cy5wbGF0Zm9ybSA9PSBjYy5zeXMuVklWT19HQU1FKXsgIC8vdml2b1xuICAgICAgICAgICAgdGhpcy5wYWNrYWdlVmVyc2lvbiA9IFwiMS4wLjBcIjtcbiAgICAgICAgICAgIHRoaXMucGxhdGZvcm0gPSAndml2byc7XG4gICAgICAgIH1lbHNlIGlmKGNjLnN5cy5wbGF0Zm9ybSA9PSBjYy5zeXMuQU5EUk9JRCl7XG4gICAgICAgICAgICB0aGlzLnBhY2thZ2VWZXJzaW9uID0gXCIxLjAuMFwiO1xuICAgICAgICAgICAgdGhpcy5wbGF0Zm9ybSA9ICdhbmRyb2lkJztcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICB0aGlzLnBhY2thZ2VWZXJzaW9uID0gXCIxLjAuMFwiO1xuICAgICAgICAgICAgdGhpcy5wbGF0Zm9ybSA9ICdRUSc7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgY3JlYXRlT2JqID0gZnVuY3Rpb24gKGNsYXNzTmFtZSkge1xuICAgICAgICAgICAgdmFyIGN0b3JGdW4gPSByZXF1aXJlKGNsYXNzTmFtZSk7XG4gICAgICAgICAgICB2YXIgb2JqID0gbmV3IGN0b3JGdW4oc2VsZik7XG4gICAgICAgICAgICBjYy5sb2coJ+WIneWni+WMlkFwcEdhbWXml7blt7LliJvlu7olcycsIGNsYXNzTmFtZSk7XG4gICAgICAgICAgICByZXR1cm4gb2JqO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmF1ZGlvTWdyID0gY3JlYXRlT2JqKCdhdWRpb01ncicpOyAvL+mfs+aViFxuICAgICAgICB0aGlzLmVtaXR0ZXIgPSBuZXcgQXBwRW1pdHRlcih0aGlzKTsgLy/lvLnnqpfjgIHot5Hpqaznga/nrYnlhaznlKjkuovku7bnmoTms6jlhozlkozop6blj5Hlt6XlhbdcbiAgICAgICAgY2MubG9nKCdjcmVhdGUgbmV3IEFwcEdhbWUgZW5kJyk7XG4gICAgICAgIHRoaXMuc2hvdzJIaWRlKCk7XG4gICAgfSxcbiAgICBzdGF0aWNzOiB7XG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICghd2luZG93LmFwcEdhbWUpIHtcbiAgICAgICAgICAgICAgICBjYy5sb2coJ2hhdmUgbm8gd2luZG93LkFwcEdhbWUnKTtcbiAgICAgICAgICAgICAgICB3aW5kb3cuY29uc3RzID0gcmVxdWlyZSgnY29uc3RzJyk7XG4gICAgICAgICAgICAgICAgd2luZG93Lmh0dHBVdGlscyA9IHJlcXVpcmUoJ2h0dHBVdGlscycpO1xuICAgICAgICAgICAgICAgIHdpbmRvdy5hc3luYyA9IHJlcXVpcmUoJ2FzeW5jJyk7XG4gICAgICAgICAgICAgICAgd2luZG93LnVuZGVyc2NvcmUgPSByZXF1aXJlKCd1bmRlcnNjb3JlJyk7XG4gICAgICAgICAgICAgICAgd2luZG93LnV0aWwgPSByZXF1aXJlKCd1dGlsJyk7XG4gICAgICAgICAgICAgICAgd2luZG93LnBsYXRmb3JtRnVuID0gcmVxdWlyZSgncGxhdGZvcm1GdW4nKTtcbiAgICAgICAgICAgICAgICBpZihjYy5zeXMub3MgPT0gY2Muc3lzLk9TX0FORFJPSUQpIHtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmFuZHJvaWRIZWxwZXIgPSByZXF1aXJlKCdhbmRyb2lkSGVscGVyJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHdpbmRvdy5hcHBHYW1lID0gbmV3IEFwcEdhbWUoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY2MubG9nKCdoYXZlIHdpbmRvdy5hcHAsIHNvIGRvIG5vdGhpbmcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzaG93MkhpZGUoKXtcbiAgICAgICAgLyog5ri45oiP6L+b5YWl5YmN5Y+wICovXG4gICAgICAgIGNjLmdhbWUub24oY2MuZ2FtZS5FVkVOVF9TSE9XLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZihhcHBHYW1lLmludGVyc3RpdGlhbEFkJiZhcHBHYW1lLmdhbWVTZXJ2ZXJSb29tLmdhbWVDb25maWdEYXRhJiYhYXBwR2FtZS5nYW1lU2VydmVyUm9vbS5nYW1lQ29uZmlnRGF0YS5pc2Jhbm5lcil7XG4gICAgICAgICAgICAgICAgYXBwR2FtZS5pbnRlcnN0aXRpYWxBZC5wbGF5QWQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKGFwcEdhbWUuZ2FtZVNlcnZlclJvb20gJiYgYXBwR2FtZS5nYW1lU2VydmVyUm9vbS5pc0hhZFdvcmQpe1xuICAgICAgICAgICAgICAgIHV0aWwuc3ByZWFkV29yZEZ1bigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2dhbWUgZW50ZXIgZm9yZSBvbicpO1xuICAgICAgICB9KTtcbiAgICAgICAgLyog5ri45oiP6L+b5YWl5ZCO5Y+wICovXG4gICAgICAgIGNjLmdhbWUub24oY2MuZ2FtZS5FVkVOVF9ISURFLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnZ2FtZSBlbnRlciBiYWNrIG9uJyk7XG4gICAgICAgICAgICBpZihhcHBHYW1lLmdhbWVTZXJ2ZXJSb29tICYmIGFwcEdhbWUuZ2FtZVNlcnZlclJvb20ud29yZFJpZCl7XG4gICAgICAgICAgICAgICAgdXRpbC5zcHJlYWRDbG9zZShhcHBHYW1lLmdhbWVTZXJ2ZXJSb29tLndvcmRSaWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoYXBwR2FtZS5hcHBTdGFydFRpbWUhPTApey8v6LaF6L+HMTDliIbpkp/nmoTor53kuI3nlKjmiZPngrlcbiAgICAgICAgICAgICAgICBhcHBHYW1lLmFwcEZpbmlzaFRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIGFwcEdhbWUuYXBwU3RhcnRUaW1lO1xuICAgICAgICAgICAgICAgIGFwcEdhbWUuYXBwRmluaXNoVGltZSA9IHV0aWwudGltZUNvbnZlcnRJbnQoYXBwR2FtZS5hcHBGaW5pc2hUaW1lKTtcbiAgICAgICAgICAgICAgICBodHRwVXRpbHMuaHR0cFBvc3QoY29uc3RzLkhUVFBfUkVDT1JEX1NFUlZFUix7dGl0bGU6J+WFs+mXrUFQUCcsY29udGVudDonQVBQ5YGc55WZ5pe26ZW/JyxkZXNjOmFwcEdhbWUuYXBwRmluaXNoVGltZX0sZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSxcbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IEFwcEdhbWU7XG5cbnZhciBBcHBFbWl0dGVyID0gZnVuY3Rpb24gKGFwcCkge1xuICAgIHZhciBhZGRFdmVudExpc3RlbmVyID0gdGhpcy5hZGRFdmVudExpc3RlbmVyO1xuICAgIHRoaXMub24gPVxuICAgICAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbiAoZXZlbnQsIGZuLCBvYmopIHtcbiAgICAgICAgICAgIC8vY2MubG9nKCfmt7vliqBhcHDmnKzlnLDkuovku7bvvIwlcycsIGV2ZW50KTtcbiAgICAgICAgICAgIGFkZEV2ZW50TGlzdGVuZXIuY2FsbCh0aGlzLCBldmVudCwgZm4sIG9iaik7XG4gICAgICAgIH07XG4gICAgdmFyIHJlbW92ZUV2ZW50TGlzdGVuZXIgPSB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXI7XG4gICAgdGhpcy5vZmYgPVxuICAgICAgICB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbiAoZXZlbnQsIGZuKSB7XG4gICAgICAgICAgICAvL2NjLmxvZygn5Yig6ZmkYXBw5pys5Zyw5LqL5Lu277yMJXMnLCBldmVudCk7XG4gICAgICAgICAgICByZW1vdmVFdmVudExpc3RlbmVyLmNhbGwodGhpcywgZXZlbnQsIGZuKTtcbiAgICAgICAgfTtcbn07XG5cbkFwcEVtaXR0ZXIucHJvdG90eXBlID0gbmV3IEV2ZW50RW1pdHRlcigpOyJdfQ==