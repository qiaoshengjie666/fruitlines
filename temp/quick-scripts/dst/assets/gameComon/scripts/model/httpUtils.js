
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/gameComon/scripts/model/httpUtils.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '1c82dl9OYBOLaaJO15Yt8bQ', 'httpUtils');
// gameComon/scripts/model/httpUtils.js

"use strict";

module.exports = {
  onLoad: function onLoad() {},
  httpGet: function httpGet(url, cb) {
    var xhr = cc.loader.getXMLHttpRequest();

    xhr.onreadystatechange = function () {
      if (xhr.readyState === 4 && xhr.status >= 200 && xhr.status < 300) {
        var respone = xhr.responseText;
        cb && cb(null, respone);
      } else if (xhr.readyState === 4 && (xhr.status > 400 || xhr.status == 0)) {
        cb && cb(xhr.status);
      }
    };

    xhr.onerror = function (error) {
      cc.log('httpUtils onreadystatechange  onerror====' + xhr.readyState + '===' + xhr.status);

      if (xhr.readyState == 4 && xhr.status == 0 || xhr.readyState == 1 && xhr.status == 0) {
        cb && cb(503); //503   （服务不可用） 服务器目前无法使用（由于超载或停机维护）
      }
    };

    if (cc.sys.isNative) {
      xhr.setRequestHeader("Accept-Encoding", "gzip,deflate");
    }

    xhr.open("GET", url, true);
    xhr.timeout = 5000; // 5 seconds for timeout

    xhr.send();
  },
  httpGets: function httpGets(url, callback) {
    cc.log("url==" + url);
    var xhr = cc.loader.getXMLHttpRequest();
    var timedout = false;
    var timer = setTimeout(function () {
      timedout = true;
      xhr.abort();
      callback();
    }, 2000);

    xhr.onreadystatechange = function () {
      if (xhr.readyState == 4) {
        if (timedout) {
          return;
        }

        clearTimeout(timer);

        if (xhr.status >= 200 && xhr.status < 300) {
          var respone = xhr.responseText;

          if (respone) {
            callback(respone);
          }
        } else if (xhr.status > 400 || xhr.status == 0) {
          callback("false");
        }
      }
    };

    xhr.open("GET", url, true);
    xhr.setRequestHeader("Content-Type", "text/plain;charset=UTF-8");

    if (cc.sys.isNative) {
      xhr.setRequestHeader("Accept-Encoding", "gzip,deflate");
    }

    xhr.send();
  },
  httpPost: function httpPost(url, params, callback) {
    var query = [];
    var snmiguid = cc.sys.localStorage.getItem('snmi_guid');
    query['snmi'] = encodeURIComponent(JSON.stringify(snmiguid));
    query['deviceInfo'] = encodeURIComponent(JSON.stringify(appGame.deviceInfo));
    query['timestamp'] = new Date().getTime();
    var info = {
      'package': consts.HTTP_RECORD_PACKAGE,
      'packageName': consts.HTTP_RECORD_PACKAGENAME,
      'packageVersion': appGame.packageVersion,
      'versionCode': '1',
      'platfrom': appGame.platform
    };
    query['manifest'] = encodeURIComponent(JSON.stringify(info));
    query['title'] = encodeURIComponent(params.title);
    query['content'] = encodeURIComponent(params.content);

    if (params.desc) {
      query['desc'] = encodeURIComponent(params.desc);
    } else {
      query['desc'] = encodeURIComponent('');
    }

    var xhr = cc.loader.getXMLHttpRequest();

    xhr.onreadystatechange = function () {
      if (xhr.readyState === 4 && xhr.status >= 200 && xhr.status < 300) {
        var respone = xhr.responseText;

        if (respone) {
          callback(respone);
        }
      } else {
        callback(-1);
      }
    }; //xhr.open("POST", url, true);
    //xhr.send(params);  decodeURIComponent


    var geturl = url + "?" + Object.keys(query).map(function (key) {
      return key + "=" + query[key];
    }).join('&'); //cc.log("geturl===="+geturl)

    xhr.open("GET", geturl, true);
    xhr.send();
  },
  httpSendRequest: function httpSendRequest(url, callback) {
    //cc.log("url==="+url)
    var xhr = cc.loader.getXMLHttpRequest();
    var timedout = false;
    var timer = setTimeout(function () {
      timedout = true;
      xhr.abort();
      callback(-1);
    }, 2000);

    xhr.onreadystatechange = function () {
      if (xhr.readyState == 4) {
        if (timedout) {
          return;
        }

        clearTimeout(timer);

        if (xhr.status >= 200 && xhr.status < 300) {
          var respone = xhr.responseText;

          if (respone) {
            var respones = JSON.parse(respone);
            callback(respones);
          } else {
            callback(1);
          }
        } else if (xhr.status > 400 || xhr.status == 0) {
          callback(-1);
        }
      }
    };

    xhr.open("POST", url, true);
    xhr.send(); //xhr.open("POST", url, true);
    //xhr.send(params);
  },
  httpPostParam: function httpPostParam(url, params, callback) {
    var xhr = cc.loader.getXMLHttpRequest();

    xhr.onreadystatechange = function () {
      console.log('xhr.readyState=' + xhr.readyState + '  xhr.status=' + xhr.status);

      if (xhr.readyState === 4 && xhr.status >= 200 && xhr.status < 300) {
        var respone = xhr.responseText;

        if (respone) {
          var pars = JSON.parse(respone);
          callback(pars);
        }
      } else {
        callback(-1);
      }
    };

    xhr.open("POST", url, true); //xhr.setRequestHeader('Access-Control-Allow-Origin', '*'); 
    //xhr.setRequestHeader('content-type', 'application/json')

    xhr.timeout = 5000; // 5 seconds for timeout  

    var payload = JSON.stringify(params);
    xhr.send(payload);
  },
  loadNetToNativeImg: function loadNetToNativeImg(url, callback) {
    var dirpath = jsb.fileUtils.getWritablePath() + 'img/';
    var filepath = dirpath + MD5(url) + '.png';

    function loadEnd() {
      cc.loader.load(filepath, function (err, tex) {
        if (err) {
          cc.error(err);
        } else {
          var spriteFrame = new cc.SpriteFrame(tex);

          if (spriteFrame) {
            spriteFrame.retain();
            callback(spriteFrame);
          }
        }
      });
    }

    if (jsb.fileUtils.isFileExist(filepath)) {
      cc.log('Remote is find' + filepath);
      loadEnd();
      return;
    }

    var saveFile = function saveFile(data) {
      if (typeof data !== 'undefined') {
        if (!jsb.fileUtils.isDirectoryExist(dirpath)) {
          jsb.fileUtils.createDirectory(dirpath);
        }

        if (jsb.fileUtils.writeDataToFile(new Uint8Array(data), filepath)) {
          cc.log('Remote write file succeed.');
          loadEnd();
        } else {
          cc.log('Remote write file failed.');
        }
      } else {
        cc.log('Remote download file failed.');
      }
    };

    var xhr = new XMLHttpRequest();

    xhr.onreadystatechange = function () {
      cc.log("xhr.readyState  " + xhr.readyState);
      cc.log("xhr.status  " + xhr.status);

      if (xhr.readyState === 4) {
        if (xhr.status === 200) {
          xhr.responseType = 'arraybuffer';
          saveFile(xhr.response);
        } else {
          saveFile(null);
        }
      }
    }.bind(this);

    xhr.open("GET", url, true);
    xhr.send();
  }
};

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcZ2FtZUNvbW9uXFxzY3JpcHRzXFxtb2RlbFxcaHR0cFV0aWxzLmpzIl0sIm5hbWVzIjpbIm1vZHVsZSIsImV4cG9ydHMiLCJvbkxvYWQiLCJodHRwR2V0IiwidXJsIiwiY2IiLCJ4aHIiLCJjYyIsImxvYWRlciIsImdldFhNTEh0dHBSZXF1ZXN0Iiwib25yZWFkeXN0YXRlY2hhbmdlIiwicmVhZHlTdGF0ZSIsInN0YXR1cyIsInJlc3BvbmUiLCJyZXNwb25zZVRleHQiLCJvbmVycm9yIiwiZXJyb3IiLCJsb2ciLCJzeXMiLCJpc05hdGl2ZSIsInNldFJlcXVlc3RIZWFkZXIiLCJvcGVuIiwidGltZW91dCIsInNlbmQiLCJodHRwR2V0cyIsImNhbGxiYWNrIiwidGltZWRvdXQiLCJ0aW1lciIsInNldFRpbWVvdXQiLCJhYm9ydCIsImNsZWFyVGltZW91dCIsImh0dHBQb3N0IiwicGFyYW1zIiwicXVlcnkiLCJzbm1pZ3VpZCIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJlbmNvZGVVUklDb21wb25lbnQiLCJKU09OIiwic3RyaW5naWZ5IiwiYXBwR2FtZSIsImRldmljZUluZm8iLCJEYXRlIiwiZ2V0VGltZSIsImluZm8iLCJjb25zdHMiLCJIVFRQX1JFQ09SRF9QQUNLQUdFIiwiSFRUUF9SRUNPUkRfUEFDS0FHRU5BTUUiLCJwYWNrYWdlVmVyc2lvbiIsInBsYXRmb3JtIiwidGl0bGUiLCJjb250ZW50IiwiZGVzYyIsImdldHVybCIsIk9iamVjdCIsImtleXMiLCJtYXAiLCJrZXkiLCJqb2luIiwiaHR0cFNlbmRSZXF1ZXN0IiwicmVzcG9uZXMiLCJwYXJzZSIsImh0dHBQb3N0UGFyYW0iLCJjb25zb2xlIiwicGFycyIsInBheWxvYWQiLCJsb2FkTmV0VG9OYXRpdmVJbWciLCJkaXJwYXRoIiwianNiIiwiZmlsZVV0aWxzIiwiZ2V0V3JpdGFibGVQYXRoIiwiZmlsZXBhdGgiLCJNRDUiLCJsb2FkRW5kIiwibG9hZCIsImVyciIsInRleCIsInNwcml0ZUZyYW1lIiwiU3ByaXRlRnJhbWUiLCJyZXRhaW4iLCJpc0ZpbGVFeGlzdCIsInNhdmVGaWxlIiwiZGF0YSIsImlzRGlyZWN0b3J5RXhpc3QiLCJjcmVhdGVEaXJlY3RvcnkiLCJ3cml0ZURhdGFUb0ZpbGUiLCJVaW50OEFycmF5IiwiWE1MSHR0cFJlcXVlc3QiLCJyZXNwb25zZVR5cGUiLCJyZXNwb25zZSIsImJpbmQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUFBLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQjtBQUViQyxFQUFBQSxNQUFNLEVBQUUsa0JBQVksQ0FDbkIsQ0FIWTtBQUtiQyxFQUFBQSxPQUFPLEVBQUUsaUJBQVNDLEdBQVQsRUFBY0MsRUFBZCxFQUFrQjtBQUN2QixRQUFJQyxHQUFHLEdBQUdDLEVBQUUsQ0FBQ0MsTUFBSCxDQUFVQyxpQkFBVixFQUFWOztBQUNBSCxJQUFBQSxHQUFHLENBQUNJLGtCQUFKLEdBQXlCLFlBQVk7QUFDakMsVUFBSUosR0FBRyxDQUFDSyxVQUFKLEtBQW1CLENBQW5CLElBQXlCTCxHQUFHLENBQUNNLE1BQUosSUFBYyxHQUFkLElBQXFCTixHQUFHLENBQUNNLE1BQUosR0FBYSxHQUEvRCxFQUFxRTtBQUNqRSxZQUFJQyxPQUFPLEdBQUdQLEdBQUcsQ0FBQ1EsWUFBbEI7QUFDQVQsUUFBQUEsRUFBRSxJQUFJQSxFQUFFLENBQUMsSUFBRCxFQUFPUSxPQUFQLENBQVI7QUFDSCxPQUhELE1BSUssSUFBR1AsR0FBRyxDQUFDSyxVQUFKLEtBQW1CLENBQW5CLEtBQXdCTCxHQUFHLENBQUNNLE1BQUosR0FBYSxHQUFiLElBQWtCTixHQUFHLENBQUNNLE1BQUosSUFBYSxDQUF2RCxDQUFILEVBQThEO0FBQy9EUCxRQUFBQSxFQUFFLElBQUlBLEVBQUUsQ0FBQ0MsR0FBRyxDQUFDTSxNQUFMLENBQVI7QUFDSDtBQUNKLEtBUkQ7O0FBU0FOLElBQUFBLEdBQUcsQ0FBQ1MsT0FBSixHQUFjLFVBQVVDLEtBQVYsRUFBaUI7QUFDM0JULE1BQUFB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VixTQUhELE1BR0s7QUFDRGxFLFVBQUFBLEVBQUUsQ0FBQ1UsR0FBSCxDQUFPLDJCQUFQO0FBQ0g7QUFDSixPQVZELE1BVUs7QUFDRFYsUUFBQUEsRUFBRSxDQUFDVSxHQUFILENBQU8sOEJBQVA7QUFDSDtBQUNKLEtBZEQ7O0FBZUEsUUFBSVgsR0FBRyxHQUFHLElBQUlpRixjQUFKLEVBQVY7O0FBRUFqRixJQUFBQSxHQUFHLENBQUNJLGtCQUFKLEdBQXlCLFlBQVk7QUFDakNILE1BQUFBLEVBQUUsQ0FBQ1UsR0FBSCxDQUFPLHFCQUFvQlgsR0FBRyxDQUFDSyxVQUEvQjtBQUNBSixNQUFBQSxFQUFFLENBQUNVLEdBQUgsQ0FBTyxpQkFBZ0JYLEdBQUcsQ0FBQ00sTUFBM0I7O0FBQ0EsVUFBSU4sR0FBRyxDQUFDSyxVQUFKLEtBQW1CLENBQXZCLEVBQTBCO0FBQ3RCLFlBQUdMLEdBQUcsQ0FBQ00sTUFBSixLQUFlLEdBQWxCLEVBQXNCO0FBQ2xCTixVQUFBQSxHQUFHLENBQUNrRixZQUFKLEdBQW1CLGFBQW5CO0FBQ0FQLFVBQUFBLFFBQVEsQ0FBQzNFLEdBQUcsQ0FBQ21GLFFBQUwsQ0FBUjtBQUNILFNBSEQsTUFHSztBQUNEUixVQUFBQSxRQUFRLENBQUMsSUFBRCxDQUFSO0FBQ0g7QUFDSjtBQUNKLEtBWHdCLENBV3ZCUyxJQVh1QixDQVdsQixJQVhrQixDQUF6Qjs7QUFZQXBGLElBQUFBLEdBQUcsQ0FBQ2UsSUFBSixDQUFTLEtBQVQsRUFBZ0JqQixHQUFoQixFQUFxQixJQUFyQjtBQUNBRSxJQUFBQSxHQUFHLENBQUNpQixJQUFKO0FBQ0g7QUFuTlksQ0FBakIiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbIm1vZHVsZS5leHBvcnRzID0ge1xuICBcbiAgICBvbkxvYWQ6IGZ1bmN0aW9uICgpIHsgIFxuICAgIH0sXG5cbiAgICBodHRwR2V0OiBmdW5jdGlvbih1cmwsIGNiKSB7XG4gICAgICAgIHZhciB4aHIgPSBjYy5sb2FkZXIuZ2V0WE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICh4aHIucmVhZHlTdGF0ZSA9PT0gNCAmJiAoeGhyLnN0YXR1cyA+PSAyMDAgJiYgeGhyLnN0YXR1cyA8IDMwMCkpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmVzcG9uZSA9IHhoci5yZXNwb25zZVRleHQ7XG4gICAgICAgICAgICAgICAgY2IgJiYgY2IobnVsbCwgcmVzcG9uZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmKHhoci5yZWFkeVN0YXRlID09PSA0JiYgKHhoci5zdGF0dXMgPiA0MDB8fHhoci5zdGF0dXMgPT0wKSApe1xuICAgICAgICAgICAgICAgIGNiICYmIGNiKHhoci5zdGF0dXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB4aHIub25lcnJvciA9IGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgY2MubG9nKCdodHRwVXRpbHMgb25yZWFkeXN0YXRlY2hhbmdlICBvbmVycm9yPT09PScreGhyLnJlYWR5U3RhdGUrJz09PScreGhyLnN0YXR1cyk7XG4gICAgICAgICAgICBpZiAoKHhoci5yZWFkeVN0YXRlID09IDQgJiYgeGhyLnN0YXR1cyA9PSAwKXx8KHhoci5yZWFkeVN0YXRlID09IDEgJiYgeGhyLnN0YXR1cyA9PSAwKSkge1xuICAgICAgICAgICAgICAgIGNiICYmIGNiKDUwMyk7IC8vNTAzICAg77yI5pyN5Yqh5LiN5Y+v55So77yJIOacjeWKoeWZqOebruWJjeaXoOazleS9v+eUqO+8iOeUseS6jui2hei9veaIluWBnOacuue7tOaKpO+8iVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcIkFjY2VwdC1FbmNvZGluZ1wiLCBcImd6aXAsZGVmbGF0ZVwiKTtcbiAgICAgICAgfVxuICAgICAgICB4aHIub3BlbihcIkdFVFwiLCB1cmwsIHRydWUpO1xuICAgICAgICB4aHIudGltZW91dCA9IDUwMDA7Ly8gNSBzZWNvbmRzIGZvciB0aW1lb3V0XG4gICAgICAgIHhoci5zZW5kKCk7XG4gICAgfSxcbiAgXG4gICAgaHR0cEdldHM6IGZ1bmN0aW9uICh1cmwsIGNhbGxiYWNrKSB7ICBcbiAgICAgICAgY2MubG9nKFwidXJsPT1cIit1cmwpXG4gICAgICAgIHZhciB4aHIgPSBjYy5sb2FkZXIuZ2V0WE1MSHR0cFJlcXVlc3QoKTsgIFxuICAgICAgICB2YXIgdGltZWRvdXQgPWZhbHNlO1xuICAgICAgICB2YXIgdGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aW1lZG91dCA9dHJ1ZTtcbiAgICAgICAgICAgIHhoci5hYm9ydCgpO1xuICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgfSwyMDAwKTtcbiAgICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHsgIFxuICAgICAgICAgICAgaWYoeGhyLnJlYWR5U3RhdGUgPT0gNCl7XG4gICAgICAgICAgICAgICAgaWYodGltZWRvdXQpe3JldHVybjt9XG4gICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVyKTtcbiAgICAgICAgICAgICAgICBpZiAoeGhyLnN0YXR1cyA+PSAyMDAgJiYgeGhyLnN0YXR1cyA8IDMwMCkgeyAgXG4gICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25lID0geGhyLnJlc3BvbnNlVGV4dDsgIFxuICAgICAgICAgICAgICAgICAgICBpZihyZXNwb25lKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKHJlc3BvbmUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBcbiAgICAgICAgICAgICAgICBlbHNlIGlmKHhoci5zdGF0dXMgPiA0MDB8fHhoci5zdGF0dXMgPT0wKXtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soXCJmYWxzZVwiKTsgIFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTsgIFxuICAgICAgICB4aHIub3BlbihcIkdFVFwiLCB1cmwsIHRydWUpOyAgXG4gICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKFwiQ29udGVudC1UeXBlXCIsXCJ0ZXh0L3BsYWluO2NoYXJzZXQ9VVRGLThcIik7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHsgIFxuICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoXCJBY2NlcHQtRW5jb2RpbmdcIiwgXCJnemlwLGRlZmxhdGVcIik7ICBcbiAgICAgICAgfSAgIFxuICAgICAgICB4aHIuc2VuZCgpOyAgXG4gICAgfSwgIFxuICBcbiAgICBodHRwUG9zdDogZnVuY3Rpb24gKHVybCwgcGFyYW1zLCBjYWxsYmFjaykgeyBcbiAgICAgICAgbGV0IHF1ZXJ5ID0gW107XG4gICAgICAgIGxldCBzbm1pZ3VpZCA9IGNjLnN5cy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnc25taV9ndWlkJylcbiAgICAgICAgcXVlcnlbJ3NubWknXSA9IGVuY29kZVVSSUNvbXBvbmVudChKU09OLnN0cmluZ2lmeShzbm1pZ3VpZCkpO1xuICAgICAgICBxdWVyeVsnZGV2aWNlSW5mbyddID0gZW5jb2RlVVJJQ29tcG9uZW50KEpTT04uc3RyaW5naWZ5KGFwcEdhbWUuZGV2aWNlSW5mbykpOyBcbiAgICAgICAgcXVlcnlbJ3RpbWVzdGFtcCddID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgICAgIGxldCBpbmZvID0ge1xuICAgICAgICAgICAgJ3BhY2thZ2UnOmNvbnN0cy5IVFRQX1JFQ09SRF9QQUNLQUdFLFxuICAgICAgICAgICAgJ3BhY2thZ2VOYW1lJzpjb25zdHMuSFRUUF9SRUNPUkRfUEFDS0FHRU5BTUUsXG4gICAgICAgICAgICAncGFja2FnZVZlcnNpb24nOmFwcEdhbWUucGFja2FnZVZlcnNpb24sXG4gICAgICAgICAgICAndmVyc2lvbkNvZGUnOiAnMScsXG4gICAgICAgICAgICAncGxhdGZyb20nOmFwcEdhbWUucGxhdGZvcm1cbiAgICAgICAgfVxuICAgICAgICBxdWVyeVsnbWFuaWZlc3QnXSA9IGVuY29kZVVSSUNvbXBvbmVudChKU09OLnN0cmluZ2lmeShpbmZvKSk7XG4gICAgICAgIHF1ZXJ5Wyd0aXRsZSddID0gZW5jb2RlVVJJQ29tcG9uZW50KHBhcmFtcy50aXRsZSk7XG4gICAgICAgIHF1ZXJ5Wydjb250ZW50J10gPSBlbmNvZGVVUklDb21wb25lbnQocGFyYW1zLmNvbnRlbnQpO1xuICAgICAgICBpZihwYXJhbXMuZGVzYyl7XG4gICAgICAgICAgICBxdWVyeVsnZGVzYyddID0gZW5jb2RlVVJJQ29tcG9uZW50KHBhcmFtcy5kZXNjKTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICBxdWVyeVsnZGVzYyddID0gZW5jb2RlVVJJQ29tcG9uZW50KCcnKTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgeGhyID0gY2MubG9hZGVyLmdldFhNTEh0dHBSZXF1ZXN0KCk7ICBcbiAgICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHsgIFxuICAgICAgICAgICAgaWYgKHhoci5yZWFkeVN0YXRlID09PSA0ICYmICh4aHIuc3RhdHVzID49IDIwMCAmJiB4aHIuc3RhdHVzIDwgMzAwKSkgeyAgXG4gICAgICAgICAgICAgICAgdmFyIHJlc3BvbmUgPSB4aHIucmVzcG9uc2VUZXh0OyAgXG4gICAgICAgICAgICAgICAgaWYocmVzcG9uZSl7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKHJlc3BvbmUpOyBcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9ZWxzZXsgIFxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKC0xKTsgIFxuICAgICAgICAgICAgfSAgXG4gICAgICAgIH07ICBcbiAgICAgICAgLy94aHIub3BlbihcIlBPU1RcIiwgdXJsLCB0cnVlKTtcbiAgICAgICAgLy94aHIuc2VuZChwYXJhbXMpOyAgZGVjb2RlVVJJQ29tcG9uZW50XG4gICAgICAgIGxldCBnZXR1cmwgPSBgJHt1cmx9PyR7T2JqZWN0LmtleXMocXVlcnkpLm1hcChrZXk9PiBgJHtrZXl9PSR7cXVlcnlba2V5XX1gKS5qb2luKCcmJyl9YFxuICAgICAgICAvL2NjLmxvZyhcImdldHVybD09PT1cIitnZXR1cmwpXG4gICAgICAgIHhoci5vcGVuKFwiR0VUXCIsIGdldHVybCwgdHJ1ZSk7XG4gICAgICAgIHhoci5zZW5kKCk7IFxuICAgIH0sXG4gICAgXG4gICAgaHR0cFNlbmRSZXF1ZXN0OiBmdW5jdGlvbiAodXJsLCBjYWxsYmFjaykge1xuICAgICAgICAvL2NjLmxvZyhcInVybD09PVwiK3VybClcbiAgICAgICAgbGV0IHhociA9IGNjLmxvYWRlci5nZXRYTUxIdHRwUmVxdWVzdCgpO1xuICAgICAgICBsZXQgdGltZWRvdXQgPWZhbHNlO1xuICAgICAgICBsZXQgdGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aW1lZG91dCA9dHJ1ZTtcbiAgICAgICAgICAgIHhoci5hYm9ydCgpO1xuICAgICAgICAgICAgY2FsbGJhY2soLTEpO1xuICAgICAgICB9LDIwMDApO1xuICAgICAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYoeGhyLnJlYWR5U3RhdGUgPT0gNCl7XG4gICAgICAgICAgICAgICAgaWYodGltZWRvdXQpe3JldHVybjt9XG4gICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVyKTtcbiAgICAgICAgICAgICAgICBpZiAoeGhyLnN0YXR1cyA+PSAyMDAgJiYgeGhyLnN0YXR1cyA8IDMwMCkgeyAgXG4gICAgICAgICAgICAgICAgICAgIGxldCByZXNwb25lID0geGhyLnJlc3BvbnNlVGV4dDtcbiAgICAgICAgICAgICAgICAgICAgaWYocmVzcG9uZSl7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgcmVzcG9uZXMgPSBKU09OLnBhcnNlKHJlc3BvbmUpXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhyZXNwb25lcyk7ICBcbiAgICAgICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygxKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gXG4gICAgICAgICAgICAgICAgZWxzZSBpZih4aHIuc3RhdHVzID4gNDAwfHx4aHIuc3RhdHVzID09MCl7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKC0xKTsgIFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTsgIFxuICAgICAgICB4aHIub3BlbihcIlBPU1RcIiwgdXJsLCB0cnVlKTtcbiAgICAgICAgeGhyLnNlbmQoKTtcbiAgICAgICAgLy94aHIub3BlbihcIlBPU1RcIiwgdXJsLCB0cnVlKTtcbiAgICAgICAgLy94aHIuc2VuZChwYXJhbXMpO1xuICAgIH0sXG5cbiAgICBodHRwUG9zdFBhcmFtOiBmdW5jdGlvbiAodXJsLCBwYXJhbXMsIGNhbGxiYWNrKSB7ICBcbiAgICAgICAgdmFyIHhociA9IGNjLmxvYWRlci5nZXRYTUxIdHRwUmVxdWVzdCgpOyAgXG4gICAgICAgIHhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoKSB7ICBcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCd4aHIucmVhZHlTdGF0ZT0nK3hoci5yZWFkeVN0YXRlKycgIHhoci5zdGF0dXM9Jyt4aHIuc3RhdHVzKTsgIFxuICAgICAgICAgICAgaWYgKHhoci5yZWFkeVN0YXRlID09PSA0ICYmICh4aHIuc3RhdHVzID49IDIwMCAmJiB4aHIuc3RhdHVzIDwgMzAwKSkge1xuICAgICAgICAgICAgICAgIHZhciByZXNwb25lID0geGhyLnJlc3BvbnNlVGV4dDtcbiAgICAgICAgICAgICAgICBpZihyZXNwb25lKXtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBhcnMgPSAgSlNPTi5wYXJzZShyZXNwb25lKVxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhwYXJzKTsgIFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1lbHNleyAgXG4gICAgICAgICAgICAgICAgY2FsbGJhY2soLTEpOyAgXG4gICAgICAgICAgICB9ICBcbiAgICAgICAgfTsgIFxuICAgICAgICB4aHIub3BlbihcIlBPU1RcIiwgdXJsLCB0cnVlKTsgXG4gICAgICAgIC8veGhyLnNldFJlcXVlc3RIZWFkZXIoJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbicsICcqJyk7IFxuICAgICAgICAvL3hoci5zZXRSZXF1ZXN0SGVhZGVyKCdjb250ZW50LXR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpXG4gICAgICAgIHhoci50aW1lb3V0ID0gNTAwMDsvLyA1IHNlY29uZHMgZm9yIHRpbWVvdXQgIFxuICAgICAgICBsZXQgcGF5bG9hZCA9IEpTT04uc3RyaW5naWZ5KHBhcmFtcyk7XG4gICAgICAgIHhoci5zZW5kKHBheWxvYWQpOyAgXG4gICAgfSxcblxuICAgIGxvYWROZXRUb05hdGl2ZUltZyA6IGZ1bmN0aW9uKHVybCwgY2FsbGJhY2spe1xuICAgICAgICB2YXIgZGlycGF0aCA9ICBqc2IuZmlsZVV0aWxzLmdldFdyaXRhYmxlUGF0aCgpICsgJ2ltZy8nO1xuICAgICAgICB2YXIgZmlsZXBhdGggPSBkaXJwYXRoICsgTUQ1KHVybCkgKyAnLnBuZyc7XG5cbiAgICAgICAgZnVuY3Rpb24gbG9hZEVuZCgpe1xuICAgICAgICAgICAgY2MubG9hZGVyLmxvYWQoZmlsZXBhdGgsIGZ1bmN0aW9uKGVyciwgdGV4KXtcbiAgICAgICAgICAgICAgICBpZiggZXJyICl7XG4gICAgICAgICAgICAgICAgICAgIGNjLmVycm9yKGVycik7XG4gICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzcHJpdGVGcmFtZSA9IG5ldyBjYy5TcHJpdGVGcmFtZSh0ZXgpO1xuICAgICAgICAgICAgICAgICAgICBpZiggc3ByaXRlRnJhbWUgKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNwcml0ZUZyYW1lLnJldGFpbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soc3ByaXRlRnJhbWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZigganNiLmZpbGVVdGlscy5pc0ZpbGVFeGlzdChmaWxlcGF0aCkgKXtcbiAgICAgICAgICAgIGNjLmxvZygnUmVtb3RlIGlzIGZpbmQnICsgZmlsZXBhdGgpO1xuICAgICAgICAgICAgbG9hZEVuZCgpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBzYXZlRmlsZSA9IGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgaWYoIHR5cGVvZiBkYXRhICE9PSAndW5kZWZpbmVkJyApe1xuICAgICAgICAgICAgICAgIGlmKCAhanNiLmZpbGVVdGlscy5pc0RpcmVjdG9yeUV4aXN0KGRpcnBhdGgpICl7XG4gICAgICAgICAgICAgICAgICAgIGpzYi5maWxlVXRpbHMuY3JlYXRlRGlyZWN0b3J5KGRpcnBhdGgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZigganNiLmZpbGVVdGlscy53cml0ZURhdGFUb0ZpbGUoICBuZXcgVWludDhBcnJheShkYXRhKSAsIGZpbGVwYXRoKSApe1xuICAgICAgICAgICAgICAgICAgICBjYy5sb2coJ1JlbW90ZSB3cml0ZSBmaWxlIHN1Y2NlZWQuJyk7XG4gICAgICAgICAgICAgICAgICAgIGxvYWRFbmQoKTtcbiAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgY2MubG9nKCdSZW1vdGUgd3JpdGUgZmlsZSBmYWlsZWQuJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgY2MubG9nKCdSZW1vdGUgZG93bmxvYWQgZmlsZSBmYWlsZWQuJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcblxuICAgICAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY2MubG9nKFwieGhyLnJlYWR5U3RhdGUgIFwiICt4aHIucmVhZHlTdGF0ZSk7XG4gICAgICAgICAgICBjYy5sb2coXCJ4aHIuc3RhdHVzICBcIiAreGhyLnN0YXR1cyk7XG4gICAgICAgICAgICBpZiAoeGhyLnJlYWR5U3RhdGUgPT09IDQpIHtcbiAgICAgICAgICAgICAgICBpZih4aHIuc3RhdHVzID09PSAyMDApe1xuICAgICAgICAgICAgICAgICAgICB4aHIucmVzcG9uc2VUeXBlID0gJ2FycmF5YnVmZmVyJztcbiAgICAgICAgICAgICAgICAgICAgc2F2ZUZpbGUoeGhyLnJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgc2F2ZUZpbGUobnVsbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LmJpbmQodGhpcyk7XG4gICAgICAgIHhoci5vcGVuKFwiR0VUXCIsIHVybCwgdHJ1ZSk7XG4gICAgICAgIHhoci5zZW5kKCk7XG4gICAgfVxuXG59OyAgXG4iXX0=