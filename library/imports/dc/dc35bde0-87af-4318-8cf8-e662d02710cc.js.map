{"version":3,"sources":["assets\\framework\\plugin_boosts\\gamesys\\PsFxPlayer.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import PsFx from \"./PsFx\";\nimport Device from \"./Device\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class PsFxPlayer extends cc.Component {\n\n    @property(cc.Prefab)\n    prefab:cc.Prefab = null\n\n    _fx:PsFx = null;\n\n    @property(cc.SpriteFrame)\n    spriteFrame:cc.SpriteFrame = null\n\n    @property({type: cc.AudioClip})\n    audioClip:cc.AudioClip;\n\n    @property\n    duration:number = -1;\n\n    @property\n    randomRotaion: boolean = false;\n\n    start () {\n    }\n\n    get fx()\n    {\n        if(this._fx == null && this.prefab)\n        {\n            let node = cc.instantiate(this.prefab);\n            if(node == null) return null;\n            let fx = node.getComponent(PsFx)\n            if(fx == null)\n            {\n                fx = this.addComponent(PsFx);\n            }\n            node.setPosition(0,0);\n            node.setParent(this.node);\n            this._fx = fx;\n        }\n        return this._fx;\n    }\n\n    isPlaying()\n    {\n        return this.fx.isPlaying;\n    }\n\n    onEnable()\n    {\n        \n    }\n\n    onDisable()\n    {\n        let fx = this._fx;\n        if(fx)\n            fx.node.active = false;\n    }\n\n    sleep(sec){\n        return new Promise((resolve,reject)=>{\n            setTimeout(_=>{\n                resolve();\n            } , sec)\n        })\n    };\n\n    async play()\n    {\n        Device.playEffect(this.audioClip,false);\n        let fx = this.fx;\n        if(fx)\n        {\n            fx.node.active = true;\n            if(this.randomRotaion)\n                //fx.node.rotation = g.randomInt(0,360);  \n            fx.reset();\n            return fx.play(this.audioClip,this.spriteFrame);\n        }else{\n            if(this.duration > 0 )\n                await this.sleep(this.duration * 1000);\n        }\n    }\n\n    // update (dt) {}\n}\n"]}