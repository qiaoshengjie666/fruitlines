{"version":3,"sources":["assets\\Game\\Scripts\\ui\\ShopDialog.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import ShopItemTemplate from \"./ShopItemTemplate\";\nimport SpriteFrameCache from \"../../../framework/plugin_boosts/misc/SpriteFrameCache\";\nimport { R } from \"../hex-lines-game/Res\";\n\nimport { UserInfo, ChoiceType } from \"../Info\";\nimport { Toast } from \"../../../framework/plugin_boosts/ui/ToastManager\";\nimport UIFunctions from \"../../../framework/plugin_boosts/ui/UIFunctions\";\nimport Device from \"../../../framework/plugin_boosts/gamesys/Device\";\nimport Main from \"../Main\";\nimport G from\"../g - 001\";\n\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class ShopDialog extends cc.Component {\n\n    @property(cc.ScrollView)\n    scrollview: cc.ScrollView = null;\n\n    @property(cc.Label)\n    freeDiamondLabel: cc.Label = null;\n\n    @property(cc.Button)\n    freeDiamondBtn: cc.Button = null;\n\n    onLoad() {\n        // this.scrollview\n    }\n\n    start() {\n\n    }\n\n    onShown() {\n        // {\"id\":\"1\",\"mini_img\":\"a1\",\"img\":\"a2\",\"cost\":\"100\"},\n        this.scrollview.showlist((node: cc.Node, data: any, i: number) => {\n            // console.log(i,data);\n            let item = node.getComponent(ShopItemTemplate);\n            item.data = data;\n            item.diamondLabel.string = data.cost;\n            let isLocked = !UserInfo.isUnlock(data.id);\n            item.btnBuyNode.active = isLocked\n            item.maskNode.active = isLocked;\n            item.borderNode.color = cc.Color.WHITE;\n            item.titleLabel.string = data.text;\n            item.selectedFlag.active = UserInfo.selectedSkin == data.id;\n            item.btnSignal.add(this.click_unlock, this)\n            SpriteFrameCache.instance.getSpriteFrame(\"Game/Textures/ThumbBgs/\" + data.mini_img + \".jpg\").then(sf => item.bgmini.spriteFrame = sf)\n        }, R.skinConfig.json)\n\n       // this.refreshBtnStatus();\n    }\n\n    refreshBtnStatus() {\n        // if (G.isNextDay(UserInfo.shopFreeDiamondTime)) {\n        //     this.freeDiamondLabel.string = \"免费得50\"\n        //     UIFunctions.setButtonEnabled(this.freeDiamondBtn, true)\n        // } else {\n        //     this.freeDiamondLabel.string = \"已领取\"\n        //     UIFunctions.setButtonEnabled(this.freeDiamondBtn, false)\n        // }\n    }\n\n    click_close() {\n\n    }\n\n    share_succ() {\n        UserInfo.addDiamond(50);\n        UserInfo.shopFreeDiamondTime = new Date().getTime();\n        UserInfo.save()\n        this.refreshBtnStatus();\n    }\n\n    click_free() {\n        let choice = UserInfo.getChoice(ChoiceType.Shop)\n        if (choice == 1) {\n        \n        } else if (choice == 0) {\n            this.share_succ()\n        } else {\n            //video\n     \n        }\n    }\n\n    selectBg(data) {\n        UserInfo.selectedSkin = data.id;\n        UserInfo.save()\n        this.onShown();\n    }\n\n    click_unlock(data) {\n        if (UserInfo.isUnlock(data.id)) {\n            //select \n            this.selectBg(data);\n            Toast.make(\"已选择 \" + data.text)\n            return;\n        }\n        if (UserInfo.diamond >= data.cost) {\n            UserInfo.diamond -= data.cost;\n            UserInfo.unlock(data.id);\n            this.selectBg(data)\n            Toast.make(cc.js.formatStr(\"%s已解锁\", data.text))\n            Device.playEffect(R.audio_unlock)\n            if (Main.instance)\n                Main.instance.refreshRedpoints()\n        } else {\n            Toast.make(\"钻石不足\")\n            Device.playEffect(R.audio_invalid)\n        }\n    }\n\n}"]}