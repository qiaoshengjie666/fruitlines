{"version":3,"sources":["assets\\framework\\plugin_boosts\\gamesys\\InfiniteBackground.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/typescript.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class InfiniteBackground extends cc.Component {\n\n    // LIFE-CYCLE CALLBACKS:\n    // onLoad () {}\n\n    @property(cc.Node)\n    bgNode:cc.Node = null;\n\n    @property(cc.Camera)\n    camera:cc.Camera= null;\n\n    next:cc.Node;\n    prev:cc.Node;\n    pre_prev :cc.Node;\n    currentNode:cc.Node = null;\n    repeatCount = 0;\n\n    size : cc.Size;\n\n    nodepool:cc.NodePool;\n    onLoad()\n    {\n        this.currentNode = this.bgNode;\n        this.size = this.currentNode.getContentSize();\n        this.nodepool = new cc.NodePool();\n    }\n\n    start () {\n        if(this.prev == null)\n        {\n            this.prev = cc.instantiate(this.bgNode);\n            this.node.addChild(this.prev);\n            this.prev.y =  - this.size.height;\n        }\n    }\n\n    reset()\n    {\n        this.repeatCount = 0;\n        //todo :remove all \n        //todo:init all\n    }\n    \n    update (dt) {\n\n        if(this.currentNode == null)return\n        let pos = cc.Vec2.ZERO;\n        this.camera.getWorldToCameraPoint(this.currentNode.position,pos)\n        let prev = this.prev;\n        if (pos.y < 10)\n        {\n            // check has next \n            if(this.next == null)\n            {\n                this.pre_prev = this.prev;\n                this.prev = this.currentNode;\n                let road = this.nodepool.get()\n                if(road == null)\n                    road = cc.instantiate(this.currentNode);\n                road.setPosition(0,this.size.height * ++this.repeatCount);\n                this.node.addChild(road);\n                this.currentNode = road;\n                this.camera.getWorldToCameraPoint(road.position,pos)\n                this.next = null;\n                // console.log(\"create new road\")\n            }\n        }\n        if(pos.y > this.size.height - 10)\n        {\n            //remove previous\n            if(this.pre_prev)\n            {\n                this.nodepool.put(this.pre_prev);\n                // console.log(\"InfiniteBackground : recycle background:\" ,this.nodepool.size())\n            }\n        }\n        //todo remove \n    }\n}\n"]}